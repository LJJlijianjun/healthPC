(function(n){var t;n.fn.GWSelectOrg=function(i){var u={allowClear:!0,data:null,dataUrl:null,dataListType:"OrgDeptList",defaultValue:[0],defaultName:[],method:"get",async:!0,cache:!1,dataType:"json",singleSelect:!1,beforeSend:null,onLoadingError:null,onDataLoaded:null,onDataLoadCompleted:null,onSelelcted:null},o=arguments,r=this,s=function(){var i=[];return n(".orgSelector input[type=checkbox]:checked",n(r)).each(function(){if(t.dataListType=="OrgDeptList"){if(n(this).hasClass("selectAll"))return i.push({OrgId:0,OrgName:"全公司"}),!1;n(this).hasClass("itemAll")||i.push({OrgId:n(this).parent().parent().data("orgid"),OrgName:n(this).parent().next().text(),CollaborateType:n(this).parent().parent().parent().parent().parent().prev().find(".tags-label").data("collaboratetype"),CollaborateTypeName:n(this).parent().parent().parent().parent().parent().prev().find(".tags-label").data("collaboratetypename")})}else n(this).hasClass("selectAll")||n(this).hasClass("itemAll")||i.push({OrgId:n(this).parent().parent().data("orgid"),OrgName:n(this).parent().next().text(),CollaborateType:n(this).parent().parent().parent().parent().parent().prev().find(".tags-label").data("collaboratetype"),CollaborateTypeName:n(this).parent().parent().parent().parent().parent().prev().find(".tags-label").data("collaboratetypename")})}),i},f=function(){var i=[];return n(".orgSelector input[type=checkbox]:checked",n(r)).each(function(){if(t.dataListType=="OrgDeptList"){if(n(this).hasClass("selectAll"))return i.push(0),!1;n(this).hasClass("itemAll")||i.push(n(this).parent().parent().data("orgid"))}else n(this).hasClass("selectAll")||n(this).hasClass("itemAll")||i.push(n(this).parent().parent().data("orgid"))}),i},h=function(){var i,u,o,s,e;if(t.defaultValue.length>0){if(t.defaultValue.length==1&&t.defaultValue[0]==0)r.find(".tags-label input[type=checkbox]").iCheck("check");else{for(r.find(".tags-label input[type=checkbox]").iCheck("uncheck"),i=0;i<t.defaultValue.length;i++)if($this=n(r.find(".orgSelector")).find(".tags-label[data-orgid="+t.defaultValue[i]+"]").find("input[type=checkbox]"),t.singleSelect){if($this.hasClass("selectAll")||$this.hasClass("itemAll"))return!1;r.find(".tags-label input[type=checkbox]:checked").iCheck("uncheck");$this.iCheck("check")}else $this.iCheck("check"),$this.hasClass("selectAll")?r.find(".tags-label input[type=checkbox]").iCheck("check"):$this.hasClass("itemAll")?($this.parent().parent().parent().parent().next().find(".tags-label input[type=checkbox]").iCheck("check"),u=r.find(".tags-label input[type=checkbox]").length-r.find(".tags-label input[type=checkbox]:checked").length,u==1&&r.find(".selectAll").iCheck("check")):(o=$this.parent().parent().parent().parent().parent().find(".tags-label input[type=checkbox]").length-$this.parent().parent().parent().parent().parent().find(".tags-label input[type=checkbox]:checked").length,o<1&&$this.parent().parent().parent().parent().parent().prev().find(".tags-label input[type=checkbox]").iCheck("check"),u=r.find(".tags-label input[type=checkbox]").length-r.find(".tags-label input[type=checkbox]:checked").length,u==1&&r.find(".selectAll").iCheck("check"));s=f();n("#selPublishOrg").find("div.GWSelectOrg-selection__rendered").val(s.toString())}e="";e=t.defaultValue.length>0&&t.defaultName.length>0?t.defaultName.toString():"全公司";r.find("div.GWSelectOrg-selection__rendered").html("");r.find("div.GWSelectOrg-selection__rendered").append(n('<div title="'+e+'">'+e+"<\/div>").addClass("renderedText"));r.find("div.GWSelectOrg-selection__clear").show()}},e={getSelectedOrgs:s,getSelectedOrgIDs:f,reSetSelected:h};return typeof i=="string"&&n.isFunction(e[i])?e[i].apply(this,Array.prototype.slice.call(o,1)):this.each(function(){var f=n(this),e=n.extend(u,i),h,c;t=n.extend(u,i);f.css("width",f.width());h=function(){var t,i,r,u,o,s;if(f.html(""),f.addClass("GWSelectOrg"),f.addClass("GWSelectOrg-container"),f.addClass("GWSelectOrg-container--default"),f.addClass("GWSelectOrg-container--below"),t='<div class="selection">',t+='<div class="GWSelectOrg-selection GWSelectOrg-selection--default">',i="",i=e.defaultValue.length>0&&e.defaultName.length>0?e.defaultName.toString():"全公司",r='<div title="'+i+'" class="GWSelectOrg-selection__rendered">'+i+"<\/div>",t+=r,u=e.allowClear?'<div class="GWSelectOrg-selection__clear">×<\/div>':"",t+=u,o='<div class="GWSelectOrg-selection__arrow"><b class="arrow-close"><\/b><\/div>',t+=o,t+="<\/div>",t+="<\/div>",f.html(t),s=n('<div class=" GWSelectOrg-dropdown-wrapper GWSelectOrg-dropdown-hidden GWSelectOrg-dropdown-menu"><\/div>'),f.append(s),e.data!=null)l(e.data,f.find("div.GWSelectOrg-dropdown-wrapper"));else if(e.dataUrl!=null)f.processServerData(e.parms);else return!1};f.ajaxRequest=null;f.counter=0;c=function(t,i){f.ajaxRequest&&f.ajaxRequest.abort();var r={type:e.method,url:e.dataUrl,data:t,async:e.async,cache:e.cache,dataType:e.dataType,beforeSend:function(){e.beforeSend&&n.isFunction(e.beforeSend)&&e.beforeSend(t)},success:function(t){if(f.ajaxRequest=null,t&&t.Success==!0&&t.Data){if(e.onDataLoaded&&n.isFunction(e.onDataLoaded))e.onDataLoaded(t.Data);i(t.Data)}},error:function(t,i){if(i!="abort"&&e.onLoadingError&&n.isFunction(e.onLoadingError))e.onLoadingError(t,i)}};e.contentType&&(r.contentType=e.contentType);e.dataType==="jsonp"&&(r.jsonpCallback="callBackFake");f.ajaxRequest=n.ajax(r);f.counter++};f.processServerData=function(t){var i=f.find("div.GWSelectOrg-dropdown-wrapper");c(t,function(t){if(t&&(l(t,i),e.onDataLoadCompleted&&n.isFunction(e.onDataLoadCompleted)))e.onDataLoadCompleted(s())})};var p=function(){n(".orgSelector input[type=checkbox]",f.find("div.GWSelectOrg-dropdown-wrapper")).iCheck({checkboxClass:"icheckbox_square-blue-16"}).on("ifClicked",function(){a(n(this))});b();k()},l=function(t,i){var c,s,u,h;n(i).html("");var r="",f=[],l=[],o=t;for(u=0;u<o.length;u++)c=l.indexOf(o[u].RootID),c<0?(l[l.length]=o[u].RootID,s={},s.RootID=o[u].RootID,s.RootName=o[u].RootName,s.CollaborateType=o[u].CollaborateType,s.CollaborateTypeName=o[u].CollaborateTypeName,s.Info=[],s.Info[0]=o[u].orgInfo,f[f.length]=s):f[c].Info[f[c].Info.length]=o[u].orgInfo;for(r+='<div class="orgSelector">',e.singleSelect||(r+='<div class="group">',r+='<div class="list-inline"><div class="orgItem"><div class="tags-label" data-orgid="0">',r+='<input type="checkbox" class="selectAll"><div class="bold-orgName">',r+="全选",r+="<\/div><\/div><\/div><\/div><\/div>"),u=0;u<f.length;u++)if(f[u].Info.length==1)r+='<div class="group">',r+='<div class="list-inline"><div class="orgItem"><div class="tags-label" data-collaboratetype = "'+f[u].CollaborateType+'" data-collaboratetypename = "'+f[u].CollaborateTypeName+'" data-orgid="'+f[u].Info[0].Org_ID,r+=e.singleSelect?'"><div class="bold-orgName">':'"><input type="checkbox" class="itemAll"><div class="bold-orgName">',r+=f[u].RootName,r+="<\/div><\/div><\/div><\/div><\/div>";else{for(r+='<div class="group">',r+='<div class="list-inline exp-e"><div class="expander showList" data-itemlistid="itemList'+u+'"><\/div><div class="orgItem"><div class="tags-label" data-collaboratetype = "'+f[u].CollaborateType+'" data-collaboratetypename = "'+f[u].CollaborateTypeName+'" data-orgid="'+f[u].RootID,r+=e.singleSelect?'"><div class="bold-orgName">':'"><input type="checkbox" class="itemAll"><div class="bold-orgName">',r+=f[u].RootName,r+="<\/div><\/div><\/div><\/div>",r+='<div id="itemList'+u+'" class="list-inline collapse in itemList">',h=0;h<f[u].Info.length;h++)h%4==0&&(r+='<div class="rowTest">'),r+='<div class="orgItem"><div class="tags-label"  data-orgid="'+f[u].Info[h].Org_ID,r+='"><input type="checkbox"><div class="normal-orgName">',r+=f[u].Info[h].Name,r+="<\/div><\/div><\/div>",h%4==3?r+="<\/div>":h==f[u].Info.length-1&&(r+="<\/div>");r+="<\/div>";r+="<\/div>"}r+="<\/div>";r+='<button type="button" id="btnAffirmOrgToList" class="btnAffirmOrgToList btn btn-primary btn-right-align-first">确定<\/button>';r+='<button type="button" id="btnClear" class="btnClear btn btn-primary btn-right-align">清空<\/button>';i.html(r);p()},w=function(){var i=[];return n(".orgSelector input[type=checkbox]:checked",n(r)).each(function(){if(t.dataListType=="OrgDeptList"){if(n(this).hasClass("selectAll"))return i.push({OrgId:0,OrgName:"全公司"}),!1;n(this).hasClass("itemAll")?i.push({OrgId:n(this).parent().parent().data("orgid"),OrgName:n(this).parent().next().text(),CollaborateType:n(this).parent().parent().data("collaboratetype"),CollaborateTypeName:n(this).parent().parent().data("collaboratetypename")}):n(this).parent().parent().parent().parent().parent().prev().find(".tags-label input[type=checkbox]:checked").length==0&&i.push({OrgId:n(this).parent().parent().data("orgid"),OrgName:n(this).parent().next().text(),CollaborateType:n(this).parent().parent().parent().parent().parent().prev().find(".tags-label").data("collaboratetype"),CollaborateTypeName:n(this).parent().parent().parent().parent().parent().prev().find(".tags-label").data("collaboratetypename")})}else n(this).hasClass("selectAll")||(n(this).hasClass("itemAll")?i.push({OrgId:n(this).parent().parent().data("orgid"),OrgName:n(this).parent().next().text(),CollaborateType:n(this).parent().parent().data("collaboratetype"),CollaborateTypeName:n(this).parent().parent().data("collaboratetypename")}):n(this).parent().parent().parent().parent().parent().prev().find(".tags-label input[type=checkbox]:checked").length==0&&i.push({OrgId:n(this).parent().parent().data("orgid"),OrgName:n(this).parent().next().text(),CollaborateType:n(this).parent().parent().parent().parent().parent().prev().find(".tags-label").data("collaboratetype"),CollaborateTypeName:n(this).parent().parent().parent().parent().parent().prev().find(".tags-label").data("collaboratetypename")}))}),i},s=function(){var i=[];return n(".orgSelector input[type=checkbox]:checked",n(r)).each(function(){if(t.dataListType=="OrgDeptList"){if(n(this).hasClass("selectAll"))return i.push({OrgId:0,OrgName:"全公司"}),!1;n(this).hasClass("itemAll")||i.push({OrgId:n(this).parent().parent().data("orgid"),OrgName:n(this).parent().next().text(),CollaborateType:n(this).parent().parent().parent().parent().parent().prev().find(".tags-label").data("collaboratetype"),CollaborateTypeName:n(this).parent().parent().parent().parent().parent().prev().find(".tags-label").data("collaboratetypename")})}else n(this).hasClass("selectAll")||n(this).hasClass("itemAll")||i.push({OrgId:n(this).parent().parent().data("orgid"),OrgName:n(this).parent().next().text(),CollaborateType:n(this).parent().parent().parent().parent().parent().prev().find(".tags-label").data("collaboratetype"),CollaborateTypeName:n(this).parent().parent().parent().parent().parent().prev().find(".tags-label").data("collaboratetypename")})}),i},a=function(t){var r,i;if($this=t,e.singleSelect)if($this.is(":checked")){if($this.hasClass("selectAll")||$this.hasClass("itemAll"))return!1;$this.iCheck("uncheck")}else{if($this.hasClass("selectAll")||$this.hasClass("itemAll"))return!1;f.find(".tags-label input[type=checkbox]:checked").iCheck("uncheck");$this.iCheck("check")}else $this.is(":checked")?($this.iCheck("uncheck"),$this.hasClass("selectAll")?f.find(".tags-label input[type=checkbox]").each(function(){n(this).iCheck("uncheck")}):$this.hasClass("itemAll")?(f.find(".selectAll").iCheck("uncheck"),$this.parent().parent().parent().parent().next().find(".tags-label input[type=checkbox]").iCheck("uncheck")):(f.find(".selectAll").iCheck("uncheck"),$this.parent().parent().parent().parent().parent().prev().find(".tags-label input[type=checkbox]").iCheck("uncheck"))):($this.iCheck("check"),$this.hasClass("selectAll")?f.find(".tags-label input[type=checkbox]").each(function(){n(this).iCheck("check")}):$this.hasClass("itemAll")?($this.parent().parent().parent().parent().next().find(".tags-label input[type=checkbox]").iCheck("check"),i=f.find(".tags-label input[type=checkbox]").length-f.find(".tags-label input[type=checkbox]:checked").length,i==1&&f.find(".selectAll").iCheck("check")):(r=$this.parent().parent().parent().parent().parent().find(".tags-label input[type=checkbox]").length-$this.parent().parent().parent().parent().parent().find(".tags-label input[type=checkbox]:checked").length,r<1&&$this.parent().parent().parent().parent().parent().prev().find(".tags-label input[type=checkbox]").iCheck("check"),i=f.find(".tags-label input[type=checkbox]").length-f.find(".tags-label input[type=checkbox]:checked").length,i==1&&f.find(".selectAll").iCheck("check")))},b=function(){var t,r,i,u;if(e.defaultValue.length>0){for(t=0;t<e.defaultValue.length;t++)if($this=n(f.find(".orgSelector .orgItem")).find(".tags-label[data-orgid="+e.defaultValue[t]+"]").find("input[type=checkbox]"),e.singleSelect){if($this.hasClass("selectAll")||$this.hasClass("itemAll"))return!1;f.find(".tags-label input[type=checkbox]:checked").iCheck("uncheck");$this.iCheck("check")}else $this.iCheck("check"),$this.hasClass("selectAll")?f.find(".tags-label input[type=checkbox]").each(function(){n(this).iCheck("check")}):$this.hasClass("itemAll")?($this.parent().parent().parent().parent().next().find(".tags-label input[type=checkbox]").iCheck("check"),i=f.find(".tags-label input[type=checkbox]").length-f.find(".tags-label input[type=checkbox]:checked").length,i==1&&f.find(".selectAll").iCheck("check")):(r=$this.parent().parent().parent().parent().parent().find(".tags-label input[type=checkbox]").length-$this.parent().parent().parent().parent().parent().find(".tags-label input[type=checkbox]:checked").length,r<1&&$this.parent().parent().parent().parent().parent().prev().find(".tags-label input[type=checkbox]").iCheck("check"),i=f.find(".tags-label input[type=checkbox]").length-f.find(".tags-label input[type=checkbox]:checked").length,i==1&&f.find(".selectAll").iCheck("check"));u=s();n("#selPublishOrg").find("div.GWSelectOrg-selection__rendered").val(u.toString())}},k=function(){var t=!0;try{n.browser&&n.browser.msie&&n.browser.version&&parseInt(n.browser.version)<10&&(t=!1)}catch(i){}n(".showList",f.find(".orgSelector")).on("click",function(){var i=n(this).data().itemlistid;n(this).parent().hasClass("exp-e")?(n(this).parent().removeClass("exp-e"),t||n("#"+i,f.find(".orgSelector")).removeClass("collapse in").addClass("collapse")):(n(this).parent().addClass("exp-e"),t||n("#"+i,f.find(".orgSelector")).removeClass("collapse").addClass("collapse in"));n("#"+i).collapse("toggle")})},d=function(){f.find(".GWSelectOrg-selection__arrow b").removeClass("arrow-close");f.find(".GWSelectOrg-selection__arrow b").addClass("arrow-open")},g=function(){f.find(".GWSelectOrg-selection__arrow b").removeClass("arrow-open");f.find(".GWSelectOrg-selection__arrow b").addClass("arrow-close")},o=function(){return g(),f.find("div.GWSelectOrg-dropdown-wrapper").hasClass("GWSelectOrg-dropdown-hidden")?!1:(f.find("div.GWSelectOrg-dropdown-wrapper").addClass("GWSelectOrg-dropdown-hidden"),!0)},v=function(){if(d(),f.find("div.GWSelectOrg-dropdown-wrapper").hasClass("GWSelectOrg-dropdown-hidden"))f.find("div.GWSelectOrg-dropdown-wrapper").removeClass("GWSelectOrg-dropdown-hidden");else return!1},y=function(t){var h=w(),e=s(),u="",c="",r="",i;if(h==[])return o(),t(e),!1;for(i=0;i<h.length;i++)r+=h[i].OrgName,r+=",";for(i=0;i<e.length;i++)u+=e[i].OrgId,u+=",",c+=e[i].OrgName,c+=",";u=u.substr(0,u.length-1);r=r.substr(0,r.length-1);f.find("div.GWSelectOrg-selection__rendered").html("");f.find("div.GWSelectOrg-selection__rendered").append(n('<div title="'+r+'">'+r+"<\/div>").addClass("renderedText"));f.find("div.GWSelectOrg-selection__clear").show();f.find("div.GWSelectOrg-selection__rendered").val(u);o();h&&typeof t=="function"&&t(e)},nt=function(){f.find("div.GWSelectOrg-selection").on("click",function(n){o()||(v(),n.stopPropagation())});f.find("div.GWSelectOrg-selection__arrow").on("click",function(n){f.find("div.GWSelectOrg-selection__arrow b").hasClass("arrow-open")?o():v();n.stopPropagation()});f.find("div.GWSelectOrg-selection__clear").on("click",function(n){f.find("div.GWSelectOrg-selection__rendered").html("");f.find("div.GWSelectOrg-selection__rendered").attr("title","");f.find("div.GWSelectOrg-selection__rendered").val("");f.find("div.GWSelectOrg-selection__clear").hide();n.stopPropagation()});f.find("button .btnAffirmOrgToList").on("click",function(){y(e.onSelelcted);event.stopPropagation()});n(".btnClear").on("click",function(){f.find(".tags-label input[type=checkbox]").iCheck("uncheck")});f.on("click",function(t){if(n(t.target).hasClass("GWSelectOrg-dropdown-wrapper"))return!1;if(n(t.target).hasClass("btnAffirmOrgToList"))y(e.onSelelcted),t.stopPropagation();else if(n(t.target).hasClass("btnClear"))f.find(".tags-label input[type=checkbox]").iCheck("uncheck");else if(n(t.target).hasClass("normal-orgName")||n(t.target).hasClass("bold-orgName")){var i=n(t.target).parent().find("input[type=checkbox]");a(i)}return!1});n(document).on("click",function(t){!n(t.target).parents(".GWSelectOrg-dropdown-wrapper").length>0&&!n(t.target).parents(".GWSelectOrg-selection__arrow").length>0&&o()})};h();nt()})};String.prototype.format||(String.prototype.format=function(){var n=arguments;return this.replace(/{(\d+)}/g,function(t,i){return typeof n[i]!="undefined"?n[i]:t})})})(jQuery);