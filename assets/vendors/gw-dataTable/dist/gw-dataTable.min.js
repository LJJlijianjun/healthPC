(function(n){"use strict";var i={tableTitle:"",tableCollapse:!1,tableIcon:!1,toolbar:{btn:[],selector:""},showLine:!0,tableOverflowY:"auto",showHeader:!0,headerTextWeightBold:!0,columns:[],idField:"",rowNumbers:!1,checkbox:!1,multiCheck:!1,rowStriped:!0,rowHover:!0,rowSelect:!1,checkOnSelect:!1,rowStyler:function(){},rowAttr:function(){},onRowCheck:function(){},onRowUnCheck:function(){},onRowCheckAll:function(){},onRowUnCheckAll:function(){},data:null,dataUrl:null,method:"get",params:{},queryParams:function(){},loadMsg:"加载中...",async:!0,cache:!1,dataType:"json",noDataImgPath:"",noDataText:"暂无数据。",pagination:!1,pageNumber:1,pageSize:0,onNoData:null,onLoadError:function(){},onBeforeLoad:function(){},onLoadSuccess:function(){},onClickRow:function(){},onDblClickRow:function(){},onClickCell:function(){},onDblClickCell:function(){},onSortColumn:function(){}},t=function(t,i){this.rowDataAll=[];this.pageCountLast=0;this.sortCondition="";this.$element=n(t);this.$element.css("position","relative");this.$container=n('<div class="GWDataTable"><\/div>');this.$element.empty().append(this.$container);this.build(i)};t.prototype={constructor:t,build:function(t){var r=this,f,e;r.options=n.extend({},i,t);f=function(){var e,v,s,y,h,c,t,f,a,p;if(r.options.tableTitle&&(e=n('<div class="table-toolbar"><\/div>'),e.append('<div class="table-title-container">'+(r.options.tableCollapse===!0?'<i class="table-title-collapse-icon fa fa-minus-square-o">&nbsp;<\/i>':"")+(r.options.tableIcon===!0?'<i class="table-title-default-icon fa fa-th-large" style="'+(r.options.tableCollapse===!1?"margin-left: 0;":"")+'">&nbsp;<\/i>':"")+'<span class="table-title-text" style="'+(r.options.tableCollapse===!1&&r.options.tableIcon===!1?"margin-left: 0;":"")+'">'+r.options.tableTitle+"<\/span><\/div>"),(r.options.toolbar.btn&&r.options.toolbar.btn.length>0||r.options.toolbar.selector)&&(v=n('<div class="table-btn-container"><\/div>'),s=n('<div class="btn-group"><\/div>'),r.options.toolbar.btn&&r.options.toolbar.btn.length>0?n.each(r.options.toolbar.btn,function(t,i){var r=n('<button class="btn btn-default" id="'+(i.id?i.id:"")+'" name="'+(i.name?i.name:"")+'" type="button"><span class="fa fa-'+i.faClass+'"><\/span>&nbsp;'+i.text+"<\/button>");if(i.btnClass&&n(r).addClass(i.btnClass),i.enabled===!1?n(r).prop("disabled",!0):n.isFunction(i.enabled)&&i.enabled()===!1&&n(r).prop("disabled",!0),n.isFunction(i.onclick))n(r).off("click").on("click",function(n){n.preventDefault();i.onclick(n)});else typeof i.onclick=="string"&&n(r).attr("onclick",i.onclick);s.append(r)}):(s.append(n(r.options.toolbar.selector).html()),n(r.options.toolbar.selector).remove()),v.append(s),e.append(v)),r.$container.append(e)),r.options.showLine===!0&&(y=n('<div class="hrline"><\/div>'),r.options.tableTitle||y.css("top",0),r.$container.append(y)),h="40px",r.options.tableTitle?r.options.showLine===!0&&(h="43px"):h=r.options.showLine!==!0?"0":"3px",c=n('<div class="table-container collapse in" style="top: '+h+'"><\/div>'),r.options.showHeader===!0){t=n('<div class="table-head-container"><\/div>');t.append('<div class="table-fixed"><\/div>');var w=n('<div class="table-head"><\/div>'),l=n('<div class="table-head-row" style="font-weight: '+(r.options.headerTextWeightBold===!0?"bold":"normal")+';"><\/div>'),i=0;r.options.rowNumbers===!0&&(l.append('<div class="table-th" data-colindex="'+i+'" style="width: 20px; padding-right: 0;"><\/div>'),i+=1);r.options.checkbox===!0&&(l.append('<div class="table-th" data-colindex="'+i+'" style="width: 25px; padding-right: 0;"><input class="checkAll" type="checkbox" style="display: none;" /><\/div>'),i+=1);n.each(r.options.columns,function(){var n='style="';n+="width: "+(this.width&&this.width>0?this.width+"px":"100%")+"; ";n+="text-align: "+(this.align?this.align:"left")+";";n+='"';l.append('<div class="table-th" data-colindex="'+i+'" data-colname="'+this.field+'" '+n+">"+this.title+"<\/span>"+(this.sortable===!0?'<span class="sort" data-order="'+(this.order?this.order:"desc")+'" data-defaultorder="'+(this.order?this.order:"desc")+'"><\/span>':"")+"<\/div>");i+=1});w.append(l);t.find(".table-fixed").append(w);c.append(t)}if(f=n('<div class="table-content-container" style="'+("overflow-y: "+(r.options.pagination!==!0?r.options.tableOverflowY:"auto")+"; ")+(r.options.pagination===!0?"bottom: 45px;":"")+'"><\/div>'),r.options.pagination!==!0?r.options.tableOverflowY!=="auto"&&r.$element.css("overflow",r.options.tableOverflowY):r.$element.css("overflow","hidden"),f.append('<div class="table-fixed"><\/div>'),a=f.find(".table-fixed"),c.append(f),r.$container.append(c),f.css("top",r.options.showHeader===!0?t.height()===0?"40px":t.height():0),r.options.pagination===!0&&r.options.pageSize===0&&(r.options.pageSize=Math.floor(a.height()/40)),a.css("height","auto"),r.options.data)try{if(p=!0,r.options.onBeforeLoad&&n.isFunction(r.options.onBeforeLoad)&&r.options.onBeforeLoad(r.options.data)===!1&&(p=!1),p===!0&&(o(r.options.data,a),r.options.onLoadSuccess&&n.isFunction(r.options.onLoadSuccess)))r.options.onLoadSuccess(r.$container,r.options.data)}catch(b){if(r.options.onLoadError&&n.isFunction(r.options.onLoadError))r.options.onLoadError(b)}else r.options.dataUrl?r.$container.processServerData(r.options.pageNumber):u()};r.$element.ajaxRequest=null;e=function(t,i){var f,e;r.$element.ajaxRequest&&r.$element.ajaxRequest.abort();n.isFunction(r.options.queryParams)?(f=r.options.queryParams(t,r.options.pageSize,r.sortCondition),f&&(r.options.params=n.extend({},r.options.params,f))):r.options.pagination===!0?(r.options.params.pageNumber||(r.options.params.pageNumber=t),r.options.params.pageSize||(r.options.params.pageSize=r.options.pageSize),!r.options.params.sortCondition&&sortCondition&&(r.options.params.sortCondition=r.sortCondition)):!r.options.params.sortCondition&&sortCondition&&(r.options.params.sortCondition=r.sortCondition);e={type:r.options.method,url:r.options.dataUrl,data:r.options.params,async:r.options.async,cache:r.options.cache,dataType:r.options.dataType,beforeSend:function(){r.options.loadMsg&&r.$element.loadingUI({text:r.options.loadMsg})},success:function(t){if(r.$element.ajaxRequest=null,t&&t.Success===!0&&t.Data){var e=!0,f=t.Data;typeof f=="string"&&(f=JSON.parse(f));r.options.onBeforeLoad&&n.isFunction(r.options.onBeforeLoad)&&r.options.onBeforeLoad(f)===!1&&(e=!1);e===!0&&i(f)}else u();r.options.loadMsg&&r.$element.loadingUI("hide")},error:function(t,i){if((r.options.loadMsg&&r.$element.loadingUI("hide"),i!=="abort")&&r.options.onLoadError&&n.isFunction(r.options.onLoadError))r.options.onLoadError(i)}};r.$element.ajaxRequest=n.ajax(e)};r.$container.processServerData=function(t){var i=r.$container.find(".table-content-container .table-fixed");e(t,function(t){if(o(t,i),r.options.onLoadSuccess&&n.isFunction(r.options.onLoadSuccess))r.options.onLoadSuccess(r.$container,t)})};var s=function(t){var u,i;r.$container.find(".table-container .twbs-pagination-container").remove();u=n('<div class="twbs-pagination-container"><ul class="pagination"><\/ul><\/div>');r.$container.find(".table-container").append(u);i=t===0?0:Math.ceil(t/r.options.pageSize);i!==r.pageCountLast&&r.$container.find(".twbs-pagination-container").html('<ul class="pagination"><\/ul>');r.pageCountLast=i;i===0?r.$container.find(".twbs-pagination-container").hide():(r.$container.find(".twbs-pagination-container .pagination").twbsPagination({totalPages:i,startPage:r.options.pageNumber,visiblePages:5,initiateStartPageClick:!1,onPageClick:function(n,t){!r.options.data&&r.options.dataUrl&&(r.options.pageNumber=t,r.$container.processServerData(r.options.pageNumber))}}),r.$container.find(".twbs-pagination-container").show())},o=function(t,i){var f,e,o;i.empty();t.rows&&t.rows.length>0?(r.rowDataAll=t.rows,f='<div class="table-body">',n.each(t.rows,function(t){var s;if(r.options.pagination!==!0||!(t+1>r.options.pageSize)){var i=this,o="",e="",u=0;r.options.rowStriped&&(o=(t+1)%2==0?"background-color: #edf1f3;":"background-color: #ffffff;");r.options.rowStyler&&n.isFunction(r.options.rowStyler)&&(s=r.options.rowStyler(t,i),s&&(o+=s));r.options.rowAttr&&n.isFunction(r.options.rowAttr)&&(e=r.options.rowAttr(t,i),e&&(e=" "+e));f+='<div class="table-row"'+(r.options.idField?' data-id="'+i[r.options.idField]+'"':"")+'data-rowindex="{0}"{1} style="{2}">'.format(t,e,o);r.options.rowNumbers===!0&&(f+='<div class="table-cell textOverFlowEllipsis" data-colindex="'+u+'" style="width: 20px; padding-right: 0; text-align: center;">'+(t+1)+"<\/div>",u+=1);r.options.checkbox===!0&&(f+='<div class="table-cell textOverFlowEllipsis" data-colindex="'+u+'" style="width: 25px; padding-right: 0;"><input type="checkbox" /><\/div>',u+=1);n.each(r.options.columns,function(){var r=this,o="",e;o+=r.formatter&&n.isFunction(r.formatter)?r.formatter(i[r.field],i,t):i[r.field]||"";e='style="';e+=r.width&&r.width>0?"width: "+r.width+"px;":"width: 100%;";e+="text-align: "+(r.align||"left")+";";r.styler&&n.isFunction(r.styler)&&(e+=r.styler(i[r.field],i,t)+";");e+='"';f+='<div class="table-cell'+(r.nowrap===!1?"":" textOverFlowEllipsis")+" "+r.field+'" data-colindex="{0}" {1}>{2}<\/div>'.format(u,e,o);u+=1});f+="<\/div>"}}),f+="<\/div>",i.append(f),n.each(r.options.columns,function(){var i=!1;this.hidden===!0?i=!0:n.isFunction(this.hidden)&&(i=this.hidden(t.rows));i===!0?r.hideColumn(this.field):r.showColumn(this.field)}),e=r.$container.find(".table-content-container").width(),o=r.$container.find(".table-content-container")[0].clientWidth,o<e?r.$container.find(".table-head-container").css("right",e-o):r.$container.find(".table-head-container").css("right",0),r.options.checkbox===!0&&h(),r.options.pagination===!0&&s(t.totalcount)):(r.rowDataAll=[],n.each(r.options.columns,function(){var i=!1;this.hidden===!0?i=!0:n.isFunction(this.hidden)&&(i=this.hidden(t.rows));i===!0?r.hideColumn(this.field):r.showColumn(this.field)}),r.options.checkbox===!0&&r.options.multiCheck===!0&&(r.$container.find(".table-container .table-head-container .table-th .checkAll").hide(),r.$container.find(".table-container .table-head-container .table-th .icheckbox_square-blue-16").hide()),u());r.options.pagination===!1&&r.options.tableOverflowY==="visible"&&(r.$element.css("height","auto"),r.$element.css("height",r.$container.get(0).scrollHeight),r.$element.css("min-height",0));c()},h=function(){r.$container.find("input[type=checkbox]").iCheck({checkboxClass:"icheckbox_square-blue-16"}).on("ifClicked",function(){n(this).is(":checked")?n(this).hasClass("checkAll")?r.uncheckAll():r.uncheckRow(n(this).parent().parent().parent().data("rowindex")):n(this).hasClass("checkAll")?r.checkAll():r.checkRow(n(this).parent().parent().parent().data("rowindex"))});r.options.multiCheck===!0?(r.$container.find(".table-container .table-head-container .table-th .checkAll").iCheck("uncheck"),r.$container.find(".table-container .table-head-container .table-th .checkAll").show(),r.$container.find(".table-container .table-head-container .table-th .icheckbox_square-blue-16").show()):(r.$container.find(".table-container .table-head-container .table-th .checkAll").hide(),r.$container.find(".table-container .table-head-container .table-th .icheckbox_square-blue-16").hide())},u=function(){r.$container.find(".table-content-container .table-fixed").empty();r.options.pagination===!0&&r.$container.find(".twbs-pagination-container").hide();n.isFunction(r.options.onNoData)?r.options.onNoData():r.options.noDataImgPath?r.$container.find(".table-content-container .table-fixed").append('<div class="noData"><img src="'+r.options.noDataImgPath+'" alt="" /><\/div>'):r.$container.find(".table-content-container .table-fixed").append('<div class="noData"><div class="img"><\/div><div class="text">'+r.options.noDataText+"<\/div><\/div>")},c=function(){var t,u,i;if(r.options.tableCollapse===!0){t=!1;n.browser&&n.browser.msie&&n.browser.version&&parseInt(n.browser.version)<10&&(t=!0);r.$container.find(".table-toolbar .table-title-container .table-title-collapse-icon").off("click").on("click",function(){if(n(this).hasClass("fa-minus-square-o")){if(n(this).removeClass("fa-minus-square-o").addClass("fa-plus-square-o"),t&&(r.$container.find(".table-container").removeClass("collapse in").addClass("collapse"),r.options.pagination===!1&&r.options.tableOverflowY==="visible")){r.$element.data("height",r.$element.css("height"));var i=r.$container.find(".table-toolbar").outerHeight(!0);r.options.showLine===!0&&(i+=3);r.$element.css("height",i)}}else n(this).removeClass("fa-plus-square-o").addClass("fa-minus-square-o"),t&&(r.$container.find(".table-container").removeClass("collapse").addClass("collapse in"),r.options.pagination===!1&&r.options.tableOverflowY==="visible"&&r.$element.css("height",r.$element.data("height")));t||r.$container.find(".table-container").collapse("toggle")});if(r.options.pagination===!1&&r.options.tableOverflowY==="visible"&&!t)r.$container.find(".table-container").off("hidden.bs.collapse").on("hidden.bs.collapse",function(){r.$element.data("height",r.$element.css("height"));var n=r.$container.find(".table-toolbar").outerHeight(!0);r.options.showLine===!0&&(n+=3);r.$element.css("height",n)}).off("show.bs.collapse").on("show.bs.collapse",function(){r.$element.css("height",r.$element.data("height"))})}r.options.rowHover===!0&&(u=!1,n.browser&&n.browser.msie&&n.browser.version&&parseInt(n.browser.version)<9&&(u=!0),r.$container.find(".table-container .table-content-container .table-fixed .table-body .table-row").each(function(){n(this).on("mouseover",function(){u?n(this).addClass("row-hoverIE8"):n(this).addClass("row-hover")}).on("mouseout",function(){u?n(this).removeClass("row-hoverIE8"):n(this).removeClass("row-hover")})}));r.options.rowSelect===!0&&r.$container.find(".table-container .table-content-container .table-fixed .table-body .table-row").each(function(){var t=this;n(this).on("click",function(i){var o=!0,u,f,e;r.options.onClickRow&&n.isFunction(r.options.onClickRow)&&(u=n(t).data("rowindex"),f=r.options.onClickRow(u,r.rowDataAll[u]),typeof f=="boolean"&&(o=f));o===!0&&r.options.checkOnSelect===!0&&(e=i.target.nodeName.toLowerCase(),e!=="a"&&e!=="a"&&(n(t).hasClass("row-active")?r.uncheckRow(n(t).data("rowindex")):r.checkRow(n(t).data("rowindex"))))}).on("dblclick",function(){if(r.options.onDblClickRow&&n.isFunction(r.options.onDblClickRow)){var i=n(t).data("rowindex");r.options.onDblClickRow(i,r.rowDataAll[i])}})});i=r.$container.find(".table-container .table-head-container .table-fixed .table-head .table-head-row .table-th span.sort");i&&i.length>0&&i.each(function(){var t=n(this);t.parent().css("cursor","pointer").off("click").on("click",function(){var f=t.parent().data("colname"),u=t.data("order");u||(u="desc");r.sortCondition=f+" "+u;i.removeClass("asc").removeClass("desc");t.addClass(u);t.data("order",u==="asc"?"desc":"asc");r.options.onSortColumn&&n.isFunction(r.options.onSortColumn)&&(r.sortCondition=r.options.onSortColumn(f,u));!r.options.data&&r.options.dataUrl&&(r.options.pageNumber=1,r.pageCountLast=0,processServerData(r.options.pageNumber))})})};f()},showColumn:function(n){var t=this.$container.find(".table-container .table-head-container .table-fixed .table-head .table-head-row .table-th[data-colname="+n+"]");t.show();this.$container.find(".table-container .table-content-container .table-fixed .table-body .table-row .table-cell[data-colindex="+t.data("colindex")+"]").show()},hideColumn:function(n){var t=this.$container.find(".table-container .table-head-container .table-fixed .table-head .table-head-row .table-th[data-colname="+n+"]");t.hide();this.$container.find(".table-container .table-content-container .table-fixed .table-body .table-row .table-cell[data-colindex="+t.data("colindex")+"]").hide()},getRows:function(){return this.$container.find(".table-container .table-content-container .table-fixed .table-body .table-row")},checkAll:function(){if(this.options.multiCheck===!0){this.$container.find("input[type=checkbox]").iCheck("check");var t=this.getRows();if(t.removeClass("row-active").addClass("row-active"),this.options.onRowCheckAll&&n.isFunction(this.options.onRowCheckAll))this.options.onRowCheckAll(this.rowDataAll)}},uncheckAll:function(){this.$container.find("input[type=checkbox]:checked").iCheck("uncheck");var t=this.getRows();if(t.removeClass("row-active"),this.options.onRowUnCheckAll&&n.isFunction(this.options.onRowUnCheckAll))this.options.onRowUnCheckAll(this.rowDataAll)},checkRow:function(t){this.options.multiCheck!==!0&&this.uncheckAll();var i=this.$container.find('.table-container .table-content-container .table-fixed .table-body .table-row[data-rowindex="'+t+'"]');if(n(i).find(".table-cell input[type=checkbox]").iCheck("check"),n(i).hasClass("row-active")||n(i).addClass("row-active"),this.options.onRowCheck&&n.isFunction(this.options.onRowCheck))this.options.onRowCheck(t,this.rowDataAll[t])},uncheckRow:function(t){var i=this.$container.find('.table-container .table-content-container .table-fixed .table-body .table-row[data-rowindex="'+t+'"]');if(n(i).find(".table-cell input[type=checkbox]").iCheck("uncheck"),n(i).removeClass("row-active"),this.options.onRowUnCheck&&typeof this.options.onRowUnCheck=="function")this.options.onRowUnCheck(t,this.rowDataAll[t])},getChecked:function(){var i=this,t=[],r=this.$container.find(".table-container .table-content-container .table-fixed .table-body .table-row.row-active");return r.each(function(){t.push(i.rowDataAll[n(this).data("rowindex")])}),t},options:function(){return this.options},load:function(t,i){if(this.options.dataUrl){var r=this.$container.find(".table-container .table-head-container .table-fixed .table-head .table-head-row .table-th span.sort");r&&r.length>0&&(this.sortCondition="",r.each(function(){n(this).removeClass("asc").removeClass("desc");n(this).data("order",n(this).data("defaultorder"))}));t&&(this.options=n.extend({},this.options,t));this.options.pageNumber=i>0?i:1;this.pageCountLast=0;this.$container.processServerData(this.options.pageNumber)}},reload:function(){},loadData:function(){},getData:function(){var n=this;return n.rowDataAll},highlightRow:function(){},selectRecord:function(){}};n.fn.GWDataTable=function(i,r,u){var f=[];return this.each(function(){var e=n(this).data("GWDataTable"),o;e&&r!=="refresh"?i||r?e[i]&&(o=e[i].length===2?e[i](r,u):e[i](r),o&&f.push(o)):f.push(e):(e=new t(this,i),n(this).data("GWDataTable",e),f.push(e))}),typeof i=="string"?f.length>1?f:f[0]:f};n.fn.GWDataTable.Constructor=t;String.prototype.trim||(String.prototype.trim=function(){return this.replace(/(^\s*)|(\s*$)/g,"")});String.prototype.format||(String.prototype.format=function(){var n=arguments;return this.replace(/{(\d+)}/g,function(t,i){return typeof n[i]!="undefined"?n[i]:t})})})(jQuery);