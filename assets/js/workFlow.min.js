function debug(n){if(window.console&&window.console.log){var t=new Date;window.console.log(""+t+": "+JSON.stringify(n))}}(function(n){var t={ProcessList:function(t){var i=n.extend({},{Waitting:!0,ModelIds:"",PageNum:0,PageSize:0,Title:"",callback:null},t);n.ajax({type:"GET",url:dataServiceBaseUrl+"api/WorkFlow/Process?sid="+sid,async:!0,cache:!1,dataType:"json",data:{waitting:i.Waitting,modelIds:i.ModelIds,pageNum:i.PageNum,pageSize:i.PageSize,title:i.Title},success:function(n){n&&n.Success===!0?i.callback(n.Data):i.callback()}})},ProcessInfo:function(t,i){var u={ModelId:0,ProcessId:0,InstanceId:0,TaskId:0,Btn:{Save:null,Preview:null,EmailPreview:null,Next:null,Complete:null,Redirect:null,Back:null,Delete:null}},f=n(this),e=WFUtils.getParams(),r;u=n.extend({},u,e);r=n.extend({},u,t);WorkflowEngine.SaveInstanceContent(function(){n.ajax({type:"GET",url:dataServiceBaseUrl+"api/WorkFlow/Process?sid="+sid,async:!0,cache:!1,dataType:"json",data:{modelId:r.ModelId,processId:r.ProcessId,instanceId:r.InstanceId,taskId:r.TaskId},success:function(t){var u,e;if(t&&t.Success===!0)if(t.Message=="InvalidUser"||t.Message=="NoPermisson")window.location.href="../Common/NoRight.html";else if(t.Data){if(u=f.find(".processInfo"),u){u.find(".process-picture").attr("href","../../../assets/img/ProcessPic/"+t.Data.Model.ModelId+".png");u.find(".process-currentTask").text(t.Data.Task.TaskName);u.find(".process-detail").on("click",function(){WorkflowEngine.ShowProcessDetail(r.ProcessId)});t.Data.Instance[0].isback=="1"&&(u.find(".process-backReasonDesc").text(t.Data.Instance[0].BackReasonDesc),u.find(".process-backReason").text(t.Data.Instance[0].BackReason?t.Data.Instance[0].BackReason:""))}e=f.find(".processButtonGroup");e&&e.length>0&&e.each(function(i,u){var o,e,f;n(u).empty();o="保存";e="已审核并发布";r.ModelId===6&&(e="审核通过");f="已审核并提交";t.Data.LastTaskType=="1"&&(f="下一步",(r.ModelId===4&&r.TaskId===3||r.ModelId===5&&r.TaskId===3)&&(f="分发"));var h='<button type="button" class="btn btn-default" id="btn_GoBack_'+i+'" name="btn_GoBack"><span class="fa fa-mail-reply"><\/span>&nbsp;返回<\/button>',c='<button type="button" class="btn btn-default" id="btnWf_Save_'+i+'" name="btnWf_Save" data-loading-text="保存中..."><span class="fa fa-save"><\/span>&nbsp;'+o+"<\/button>",s='<button type="button" class="btn btn-default" id="btn_Preview_'+i+'" name="btn_Preview"><span class="fa fa-eye"><\/span>&nbsp;预览<\/button>',l='<button type="button" class="btn btn-default" id="btnWf_Next_'+i+'" name="btnWf_Next"><span class="fa fa-check"><\/span>&nbsp;'+f+"<\/button>",a='<button type="button" class="btn btn-default" id="btnWf_Complete_'+i+'" name="btnWf_Complete"><span class="fa fa-check"><\/span>&nbsp;'+e+"<\/button>",w='<button type="button" class="btn btn-default" id="btnWf_Redirect_'+i+'" name="btnWf_Redirect"><span class="fa fa-reply"><\/span>&nbsp;转办<\/button>',v='<button type="button" class="btn btn-default" id="btnWf_Back_'+i+'" name="btnWf_Back"><span class="fa fa-arrow-left"><\/span>&nbsp;回退<\/button>',y='<button type="button" class="btn btn-default" id="btnWf_Delete_'+i+'" name="btnWf_Delete"><span class="fa fa-trash-o"><\/span>&nbsp;删除<\/button>',p='<button type="button" class="btn btn-default" id="btnWf_Refuse_'+i+'" name="btnWf_Refuse"><span class="fa fa-trash-o"><\/span>&nbsp;未通过<\/button>';t.Data.LastTaskType=="1"?(n(u).append(h),r.ModelId===4&&r.TaskId===3||r.ModelId===5&&r.TaskId===3||r.ModelId==6||(r.ModelId===3||n(u).append(s),n(u).append(c),n(u).append(y))):(r.ModelId===1||r.ModelId===2)&&n(u).append(s);t.Data.NextTaskType=="2"?n(u).append(a):n(u).append(l);t.Data.Task.CanRedirect==!0&&r.ModelId!==6;t.Data.Task.CanBack==!0&&r.ModelId!==6&&n(u).append(v);r.ModelId===6&&n(u).append(p);WorkflowEngine.BindButtonAction(i,r)});r.ModelId===4&&r.TaskId===3||r.ModelId===5&&r.TaskId===3?n(".processMessage").css("display","none"):(n(".processToolBar .formTip").show(),n("#formWorkFlowMessage").show());WorkflowEngine.GetMessage();WorkflowEngine.GetInstanceContent(r.ProcessId,r.InstanceId);i&&i()}},error:function(){bootbox.alert({message:"获取流程信息失败！"})}})})}};n.fn.Workflow=function(){var n=arguments[0];if(t[n])n=t[n],arguments=Array.prototype.slice.call(arguments,1);else return bootbox.alert({message:"方法 ["+n+"] 在Workflow中不存在。"}),this;return n.apply(this,arguments)}})(jQuery);var WorkflowEngine={CreateProcess:function(n){var t=$.extend({},{modelId:0,callback:null},n);$.ajax({type:"POST",url:dataServiceBaseUrl+"api/WorkFlow/Process?modelId="+t.modelId+"&sid="+sid,async:!1,cache:!1,dataType:"json",success:function(n){n&&n.Success===!0&&n.Data&&typeof t.callback=="function"&&t.callback(n.Data)},error:function(){bootbox.alert({message:"创建流程失败！"})}})},ShowProcessDetail:function(n){var t=document.getElementById("wfProcessDetailModal"),i="../WorkFlow/ProcessDetail.html?processId="+n;t?$(t).find("iframe").attr("src",i):(t='<div class="modal fade" id="wfProcessDetailModal" tabindex="-1" role="dialog" aria-labelledby="processDetailModalLabel"><div class="modal-dialog" role="document" style="width: 900px;"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;<\/span><\/button><span class="modal-title" id="processDetailModalLabel" style="font-size: 15px; font-weight: 700; color: #353535;">流转明细及回退意见<\/span><\/div><div class="modal-body" style="height: 400px; padding-top: 0;"><iframe src="'+i+'" style="width: 100%; height: 100%; border: none;" frameborder="0"><\/iframe><\/div><\/div><\/div><\/div>',$("body").append(t));$("#wfProcessDetailModal").modal()},GetProcessDetail:function(n){var t=WFUtils.getParams();$.ajax({type:"GET",url:dataServiceBaseUrl+"api/WorkFlow/Process?sid="+sid,async:!0,cache:!1,dataType:"json",data:{processId:t.ProcessId},success:function(t){t&&t.Success===!0&&(t.Message=="NoPermisson"||t.Message=="InvalidUser"?window.location.href="../Common/NoRight.html":n(t.Data))},error:function(){}})},BindButtonAction:function(n,t){$("#btn_GoBack_"+n).on("click",function(){WorkflowEngine.RedirectToLastPage()});$("#btnWf_Save_"+n).on("click",function(){$.isFunction(t.Btn.Save)?t.Btn.Save():WorkflowAction.Save("save",function(){$(this).text()=="保存并返回"&&WorkflowEngine.RedirectToLastPage()})});$("#btn_Preview_"+n).on("click",function(){$.isFunction(t.Btn.Preview)&&t.Btn.Preview()});$("#btn_EmailPreview_"+n).on("click",function(){$.isFunction(t.Btn.EmailPreview)&&t.Btn.EmailPreview()});$("#btnWf_Next_"+n).on("click",function(){$.isFunction(t.Btn.Next)?t.Btn.Next():WorkflowAction.Next()});$("#btnWf_Complete_"+n).on("click",function(){$.isFunction(t.Btn.Complete)?t.Btn.Complete():WorkflowAction.Complete()});$("#btnWf_Redirect_"+n).on("click",function(){$.isFunction(t.Btn.Redirect)?t.Btn.Redirect():WorkflowAction.Redirect()});$("#btnWf_Back_"+n).on("click",function(){$.isFunction(t.Btn.Back)?t.Btn.Back():WorkflowAction.Back()});$("#btnWf_Delete_"+n).on("click",function(){$.isFunction(t.Btn.Delete)?t.Btn.Delete():WorkflowAction.Delete()});$("#btnWf_Refuse_"+n).on("click",function(){$.isFunction(t.Btn.Refuse)?t.Btn.Refuse():WorkflowAction.Delete()})},GetNextTask:function(n){var t=WFUtils.getParams();$.ajax({type:"GET",url:dataServiceBaseUrl+"api/WorkFlow/Task?sid="+sid,async:!0,cache:!1,dataType:"json",data:{processId:t.ProcessId,instanceId:t.InstanceId,taskId:t.TaskId},success:function(t){t&&t.Success===!0&&(t.Message=="InvalidUser"||t.Message=="NoPermisson"?window.location.href="../Common/NoRight.html":t.Data&&n(t.Data))},error:function(){}})},InstanceMoveNext:function(n,t){var r={ModelId:0,ProcessId:0,InstanceId:0,TaskId:0,NextTaskId:0,NextTaskEmpIds:""},u=WFUtils.getParams(),i;r=$.extend({},r,u);i=$.extend({},r,n);$.ajax({type:"POST",url:dataServiceBaseUrl+"api/WorkFlow/Instance/InstanceMoveNext?processId="+i.ProcessId+"&instanceId="+i.InstanceId+"&nextTaskId="+i.NextTaskId+"&nextTaskEmpIds="+i.NextTaskEmpIds+"&sid="+sid,async:!0,cache:!1,dataType:"json",success:function(n){n&&n.Success===!0&&(n.Message=="InvalidUser"||n.Message=="NoPermisson"?window.location.href="../Common/NoRight.html":t?t(u.ModelId,u.ProcessId,n.Data):n.Data>0&&WorkflowEngine.RedirectToDoListPage())},error:function(){}})},GetInstanceRedirectTaskInfo:function(n){var t=WFUtils.getParams();$.ajax({type:"GET",url:dataServiceBaseUrl+"api/WorkFlow/Task?sid="+sid,async:!0,cache:!1,dataType:"json",data:{modelId:t.ModelId,instanceId:t.InstanceId,taskId:t.TaskId},success:function(t){t&&t.Success===!0&&(t.Message=="InvalidUser"||t.Message=="NoPermisson"?window.location.href="../Common/NoRight.html":t.Data&&n(t.Data))},error:function(){}})},InstanceRedirect:function(n,t){var r={ModelId:0,ProcessId:0,InstanceId:0,TaskId:0,RedirectEmpId:""},u=WFUtils.getParams(),i;r=$.extend({},r,u);i=$.extend({},r,n);$.ajax({type:"POST",url:dataServiceBaseUrl+"api/WorkFlow/Instance/InstanceRedirect?processId="+i.ProcessId+"&instanceId="+i.InstanceId+"&taskId="+i.TaskId+"&redirectEmpId="+i.RedirectEmpId+"&sid="+sid,async:!0,cache:!1,dataType:"json",success:function(n){n&&n.Success===!0&&(n.Message=="InvalidUser"||n.Message=="NoPermisson"?window.location.href="../Common/NoRight.html":t?t(u.ModelId,u.ProcessId,n.Data):n.Data>0&&WorkflowEngine.RedirectToDoListPage())},error:function(){}})},GetInstanceBackList:function(n,t,i){var r=WFUtils.getParams();n||(n=0);$.ajax({type:"GET",url:dataServiceBaseUrl+"api/WorkFlow/Instance/GetInstanceBackList?sid="+sid,cache:!1,async:!1,dataType:"json",data:{mode:n,instanceId:r.InstanceId,CreateUserOrgID:t},success:function(n){n&&n.Success===!0&&(n.Message=="InvalidUser"||n.Message=="NoPermisson"?window.location.href="../Common/NoRight.html":n.Data&&i(n.Data))}})},InstanceBack:function(n,t){var r={ModelId:0,ProcessId:0,InstanceId:0,BackToInstanceId:0,BackToTaskId:0,BackToEmpId:0,BackReason:""},u=WFUtils.getParams(),i;r=$.extend({},r,u);i=$.extend({},r,n);$.ajax({type:"POST",url:dataServiceBaseUrl+"api/WorkFlow/Instance/InstanceBack?instanceId="+i.InstanceId+"&backToInstanceId="+i.BackToInstanceId+"&backToTaskId="+i.BackToTaskId+"&backToEmpId="+i.BackToEmpId+"&backReason="+encodeURIComponent(i.BackReason)+"&sid="+sid,async:!0,cache:!1,dataType:"json",success:function(n){n&&n.Success===!0&&(n.Message=="InvalidUser"||n.Message=="NoPermisson"?window.location.href="../Common/NoRight.html":t?t(u.ModelId,u.ProcessId,n.Data):n.Data>0&&WorkflowEngine.RedirectToDoListPage())},error:function(){}})},InstanceCanRollBack:function(){var n=$(".processButtonGroup"),t;if(n&&n.length>0){n.each(function(n,t){var i='<button type="button" class="btn btn-default" id="btn_GoBack_'+n+'" name="btn_GoBack"><span class="fa fa-mail-reply"><\/span>&nbsp;返回<\/button>';$(t).append(i);$("#btn_GoBack_"+n).on("click",function(){WorkflowEngine.RedirectToLastPage()})});t=WFUtils.getParams();$.ajax({type:"GET",url:dataServiceBaseUrl+"api/WorkFlow/Instance/GetInstanceCanRollBack?sid="+sid,async:!0,cache:!1,dataType:"json",data:{instanceId:t.InstanceId},success:function(t){t&&t.Success===!0&&(t.Message=="InvalidUser"||t.Message=="NoPermisson"?window.location.href="../Common/NoRight.html":t.Data===0&&n.each(function(n,t){var i='<button type="button" class="btn btn btn-default" id="btnWf_InstanceRollBack_'+n+'"><span class="fa fa-recycle"><\/span>&nbsp;撤回<\/button>';$(t).append(i);$("#btnWf_InstanceRollBack_"+n).on("click",function(){bootbox.confirm({size:"small",message:"确定要撤回吗？",callback:function(n){n===!0&&WorkflowAction.InstanceRollBack(function(n){n===0?bootbox.alert({message:"撤回成功！",callback:function(){WorkflowEngine.RedirectToDoListPage()}}):bootbox.alert({message:"撤回失败，对方可能已经开始办理。"})})}})})}))}});$(".processButtonGroup").parent().parent().show();$(".processInfo").find(".process-picture").attr("href","../../../assets/img/ProcessPic/"+t.ModelId+".png");$(".processInfo").find(".process-detail").on("click",function(){WorkflowEngine.ShowProcessDetail(t.ProcessId)})}},ProcessRollback:function(n,t){$.ajax({type:"PUT",url:dataServiceBaseUrl+"api/WorkFlow/Process?action=rollback&processId="+n+"&sid="+sid,cache:!1,async:!1,dataType:"json",success:function(n){n&&n.Success===!0?n.Message=="InvalidUser"||n.Message=="NoPermisson"?window.location.href="../Common/NoRight.html":t?t(n.Data):n.Data===0&&WorkflowEngine.RedirectToDoListPage():t&&t()},error:function(){t&&t()}})},GetMessage:function(n,t,i){var u=$(".processMessage"),r;u&&u.length>0&&(r=WFUtils.getParams(),$.ajax({type:"GET",url:dataServiceBaseUrl+"api/WorkFlow/Form/GetMessage?sid="+sid,async:!0,cache:!1,dataType:"json",data:{processId:n?n:r.ProcessId,instanceId:t?t:r.InstanceId,taskId:i?i:r.TaskId},success:function(n){var t,i;n&&n.Success===!0&&(n.Message=="InvalidUser"||n.Message=="NoPermisson"?window.location.href="../Common/NoRight.html":n.Data&&(t=u.find(".panel-body .workFlowMessage"),t&&t.length>0?(n.Data.CurrentInstanceMessage.length>0&&(i="",n.Data.CurrentInstanceMessage[0].ItemArray[9]&&(i=n.Data.CurrentInstanceMessage[0].ItemArray[9]),t.val(i)),WorkflowEngine.BindMessage(n.Data.ExtInstanceMessage)):WorkflowEngine.BindMessage(n.Data.AllInstanceMessage)))}}))},BindMessage:function(n){var u,t,i,r;if(n&&n.length>0){for(u=$(".processMessage").find(".panel-body .table tbody"),t=0;t<n.length;t++)i=$('<tr class="h35">'),r="",n[t].ItemArray[9]&&(r=n[t].ItemArray[9]),i.append('<td style="text-align: center;">'+n[t].ItemArray[4]+"<\/td>"),i.append('<td style="text-align: center;">'+n[t].ItemArray[6]+"<\/td>"),i.append('<td style="text-align: center;">'+n[t].ItemArray[10].replace("T"," ")+"<\/td>"),i.append('<td style="text-align: left;">'+r+"<\/td>"),u.append(i);$(".processMessage").find(".panel-body #formWorkFlowMessage").css("margin-top",10);$(".processMessage").find(".panel-body .table").show()}},GetInstanceContent:function(n,t){$.ajax({type:"GET",url:dataServiceBaseUrl+"api/WorkFlow/Form/GetInstanceContent?sid="+sid,async:!0,cache:!1,dataType:"json",data:{processId:n,instanceId:t},success:function(n){n&&n.Success===!0&&(n.Message=="InvalidUser"||n.Message=="NoPermisson"?window.location.href="../Common/NoRight.html":n.Data&&$.each(n.Data,function(n,t){$("#"+t.Table.schemaname).val()||$("#"+t.Table.schemaname).val(t.Table.Value)}))},error:function(){}})},TaskForm:function(n,t){$.ajax({type:"GET",url:dataServiceBaseUrl+"api/WorkFlow/Process?sid="+sid,async:!0,cache:!1,dataType:"json",data:{type:"task",processId:n,instanceId:t},success:function(n){n&&n.Success===!0&&(n.Message=="NoPermisson"||n.Message=="InvalidUser"?window.location.href="../Common/NoRight.html":n.Data&&(window.location.href=n.Data+"&pageNum="+$(".GWDataTable .twbs-pagination-container:first .pagination .active a").text()+"&ReportInfoID="+$.url().param("ReportInfoID")+"&FolderName="+encodeURI($.url().param("FolderName"))+"&sourceUrl="+window.location.pathname+"&CollaborateOrgID="+$.url().param("CollaborateOrgID")+"&ReportTypeKV="+$.url().param("ReportTypeKV")+"&Year="+$.url().param("Year")+"&PeriodTime="+$.url().param("PeriodTime")))}})},ViewForm:function(n,t){$.ajax({type:"GET",url:dataServiceBaseUrl+"api/WorkFlow/Process?sid="+sid,async:!0,cache:!1,dataType:"json",data:{type:"view",processId:n,instanceId:t},success:function(n){n&&n.Success===!0&&n.Data&&(window.location.href=n.Data+"&pageNum="+$(".GWDataTable .twbs-pagination-container:first .pagination .active a").text()+"&ReportInfoID="+$.url().param("ReportInfoID")+"&FolderName="+encodeURI($.url().param("FolderName"))+"&sourceUrl="+window.location.pathname+"&CollaborateOrgID="+$.url().param("CollaborateOrgID")+"&ReportTypeKV="+$.url().param("ReportTypeKV")+"&Year="+$.url().param("Year")+"&PeriodTime="+$.url().param("PeriodTime"))},error:function(){}})},RedirectToDoListPage:function(){if(window.parent&&window.parent.getToDoCount)window.parent.getToDoCount(function(){window.parent.clickNode("todoList")});else{var n=$.url().param("ReportInfoID"),t=$.url().param("FolderName");window.location.href=$.url().param("sourceUrl")+"?pageNum="+$.url().param("pageNum")+"&ReportInfoID="+n+"&FolderName="+encodeURI(t)+"&CollaborateOrgID="+$.url().param("CollaborateOrgID")+"&ReportTypeKV="+$.url().param("ReportTypeKV")+"&Year="+$.url().param("Year")+"&PeriodTime="+$.url().param("PeriodTime")}},RedirectToLastPage:function(){window.parent&&window.parent.getToDoCount&&window.parent.getToDoCount();var n=$.url().param("ReportInfoID"),t=$.url().param("FolderName");window.location.href=$.url().param("sourceUrl")+"?pageNum="+$.url().param("pageNum")+"&ReportInfoID="+n+"&FolderName="+encodeURI(t)+"&CollaborateOrgID="+$.url().param("CollaborateOrgID")+"&ReportTypeKV="+$.url().param("ReportTypeKV")+"&Year="+$.url().param("Year")+"&PeriodTime="+$.url().param("PeriodTime")},SaveInstanceContent:function(n){var t=WFUtils.getParams();$.ajax({type:"GET",url:dataServiceBaseUrl+"api/WorkFlow/Form?sid="+sid,async:!0,cache:!1,dataType:"json",data:{instanceId:t.InstanceId},success:function(i){var u,r;i&&i.Success===!0&&(i.Message=="InvalidUser"||i.Message=="NoPermisson"?window.location.href="../Common/NoRight.html":i.Data&&i.Data.length>0?(u=[],$.each(i.Data,function(n,t){var r=t.schemaname,f=$("#"+r).val(),i={};i.SchemaName=t.schemaname;i.DatabaseName=t.databasename;i.DisplayName=t.displayname;i.SchemaValue=f;u.push(i)}),r={},r.InstanceId=t.InstanceId,r.ProcessId=t.ProcessId,r.Data=u,r.ResultCode=0,r.Message="OK",$.ajax({type:"POST",url:dataServiceBaseUrl+"api/WorkFlow/Form/SaveInstanceContent?sid="+sid,data:JSON.stringify(r),async:!0,cache:!1,dataType:"json",contentType:"application/json; charset=utf-8",success:function(t){t&&t.Success===!0&&(t.Message=="InvalidUser"||t.Message=="NoPermisson"?window.location.href="../Common/NoRight.html":n&&n(t.Data))}})):n&&n())}})}},WorkflowAction={Save:function(n,t){var u=WFUtils.getParams(),i,r;n!=="back"?(i=$(".processMessage .panel-body .workFlowMessage"),i&&i.length>0?(r=i.val().trim(),filterXSS&&$.isFunction(filterXSS)&&(r=filterXSS(r)),$.ajax({url:dataServiceBaseUrl+"api/WorkFlow/Form/SaveMessage?sid="+sid,type:"post",async:!0,cache:!1,contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({ProcessID:u.ProcessId,InstanceID:u.InstanceId,TaskID:u.TaskId,MsgContent:r}),success:function(n){n&&n.Success===!0&&(n.Message=="InvalidUser"||n.Message=="NoPermisson"?window.location.href="../Common/NoRight.html":WorkflowEngine.SaveInstanceContent(t))}})):WorkflowEngine.SaveInstanceContent(t)):WorkflowEngine.SaveInstanceContent(t)},Next:function(n){var t=function(){var t=WFUtils.getParams(),i="../WorkFlow/InstanceMoveNext.html?modelId="+t.ModelId+"&processId="+t.ProcessId+"&instanceId="+t.InstanceId+"&taskId="+t.TaskId;n?n(i):window.location.href=i};WorkflowAction.Save("next",t)},Complete:function(n){var t=function(){var t=WFUtils.getParams();$.ajax({type:"PUT",url:dataServiceBaseUrl+"api/WorkFlow/Process?action=dispose&processId="+t.ProcessId+"&sid="+sid,async:!1,cache:!1,dataType:"json",success:function(t){t&&t.Success===!0?t.Message=="InvalidUser"||t.Message=="NoPermisson"?window.location.href="../Common/NoRight.html":n?n(t.Data):t.Data===0?WorkflowEngine.RedirectToDoListPage():(bootbox.alert({message:"执行失败！"}),$("body").loadingUI("hide")):(bootbox.alert({message:"执行失败！"}),$("body").loadingUI("hide"))}})};WorkflowAction.Save("complete",t)},Redirect:function(n){var t=function(){var t=WFUtils.getParams(),i="../WorkFlow/InstanceRedirect.html?modelId="+t.ModelId+"&processId="+t.ProcessId+"&instanceId="+t.InstanceId+"&taskId="+t.TaskId;n?n(i):window.location.href=i};WorkflowAction.Save("redirect",t)},Back:function(n){var t=function(){var t=WFUtils.getParams(),i="../WorkFlow/InstanceBack.html?modelId="+t.ModelId+"&processId="+t.ProcessId+"&instanceId="+t.InstanceId+"&taskId="+t.TaskId+"&publishOrgId="+$("#hidPublishOrgID").val();n?n(i):window.location.href=i};WorkflowAction.Save("back",t)},Delete:function(n){var t=WFUtils.getParams();$.ajax({type:"DELETE",url:dataServiceBaseUrl+"api/WorkFlow/Process?processId="+t.ProcessId+"&instanceId="+t.InstanceId+"&sid="+sid,async:!0,cache:!1,dataType:"json",success:function(t){t&&t.Success===!0&&(t.Message=="InvalidUser"||t.Message=="NoPermisson"?window.location.href="../Common/NoRight.html":n?n(t.Data):t.Data===0&&WorkflowEngine.RedirectToDoListPage())}})},InstanceRollBack:function(n){var t=WFUtils.getParams();$.ajax({type:"PUT",url:dataServiceBaseUrl+"api/WorkFlow/Instance?instanceId="+t.InstanceId+"&sid="+sid,async:!0,cache:!1,dataType:"json",success:function(t){t&&t.Success===!0&&(t.Message=="InvalidUser"||t.Message=="NoPermisson"?window.location.href="../Common/NoRight.html":n(t.Data))}})}},WFUtils={getParams:function(){var n={};return n.ModelId=parseInt($.url().param("modelId"),10),n.ModelId||(n.ModelId=0),n.ProcessId=parseInt($.url().param("processId"),10),n.ProcessId||(n.ProcessId=0),n.InstanceId=parseInt($.url().param("instanceId"),10),n.InstanceId||(n.InstanceId=0),n.TaskId=parseInt($.url().param("taskId"),10),n.TaskId||(n.TaskId=0),n}};