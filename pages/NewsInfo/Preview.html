<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title></title>
    <!--<link href="../../assets/css/base.css" rel="stylesheet" />-->
    <link href="../../assets/vendors/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="../../assets/vendors/font-awesome/css/font-awesome.min.css" rel="stylesheet" />
    <link href="../../assets/vendors/LoadingUI/jquery.loadingui.css" rel="stylesheet" />
    <link href="../../assets/vendors/gw-pageSideBar/dist/gw-pageSideBar.min.css?v=1.0.0" rel="stylesheet" />
    <link href="../../assets/vendors/gw-dataTable/dist/gw-dataTable.min.css?v=1.0.1" rel="stylesheet" />
    <link href="../../assets/vendors/lightbox2/dist/css/lightbox.min.css" rel="stylesheet" />
    <link href="../../assets/css/common.min.css?v=1.0.2" rel="stylesheet" />
    <link href="../../assets/css/news-particulars.css?v=1.0.2" rel="stylesheet" />
    <style>
        .color33 {
            color: #333333 !important;
        }
    </style>
    <script type="text/javascript">
        try {
            window.moveTo(0, 0);
            window.resizeTo(window.screen.availWidth, window.screen.availHeight);
        } catch (e) {
        }
    </script>
</head>
<body>
    <!--详情盒子-->
    <div class="particulars-box container" style="width:950px">
        <div class="row">
            <div class="tab-particulars" style="border:none">
                <h4 id="spTitle" style="margin-bottom:0"></h4>
                <span>时间：</span><span id="PublishTime"></span>&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;<span>作者：</span><span id="CreateUserName"></span>
            </div>
            <div class="content-particulars" id="newcontent" style="border:none">

            </div>

            <!--<div><a href="#"  onclick="a()">aa</a></div>
            <div id="img" >

            </div>-->
        </div>
    </div>

    <!--[if lt IE 9]>
    <script src="../../assets/vendors/html5shiv/dist/html5shiv.min.js" type="text/javascript"></script>
    <script src="../../assets/vendors/respond/src/respond.js" type="text/javascript"></script>
    <![endif]-->
    <script src="../../assets/vendors/jquery/dist/jquery.min.js" type="text/javascript"></script>
    <script src="../../assets/js/jquery-tools-min.js" type="text/javascript"></script>
    <script src="../../assets/js/config.min.js?v=1.0.0" type="text/javascript"></script>
    <script src="../../assets/js/auth.min.js?v=1.0.0" type="text/javascript"></script>
    <script src="../../assets/vendors/bootstrap/dist/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="../../assets/js/common.min.js?v=1.0.3" type="text/javascript"></script>
    <script src="../../assets/vendors/underscore/underscore-min.js" type="text/javascript"></script>
    <script src="../../assets/vendors/LoadingUI/jquery.loadingui.js"></script>
    <script src="../../assets/js/workFlow.min.js?v=1.0.2" type="text/javascript"></script>
    <script src="../../assets/vendors/xss/dist/xss.min.js" type="text/javascript"></script>
    <script src="../../assets/vendors/gw-pageSideBar/dist/gw-pageSideBar.min.js?v=1.0.0" type="text/javascript"></script>
    <script src="../../assets/vendors/gw-dataTable/dist/gw-dataTable.min.js?v=1.0.1"></script>
    <script src="../../assets/vendors/lightbox2/dist/js/lightbox.min.js"></script>
    <script src="../../assets/vendors/platform.js/platform.js" type="text/javascript"></script>
    <script src="../../assets/vendors/bootbox.js/bootbox.js" type="text/javascript"></script>
    <script type="text/javascript">
        var NewsInfoId = $.url().fparam('id');

        $(function () {
            AuthUtility.Auth(function () {
                if (!NewsInfoId || !parseInt(NewsInfoId)) return;
                getNewsInfo();
            });
        });

        // 获取新闻信息
        function getNewsInfo() {
            $.ajax({
                url: dataServiceBaseUrl + 'api/NewsInfo/NewsInfo/GetReadNewsInfo?sid=' + sid,
                type: 'get',
                data: {
                    NewsInfoId: NewsInfoId
                },
                async: true,
                cache: false,
                success: function (data) {
                    if (data && data.Success === true) {
                        if (data.Message == 'InvalidUser' || data.Message == 'NoPermisson') {
                            window.location.href = '../Common/NoRight.html';
                        } else if (data.Data) {
                            loadProductInfoData(data.Data);
                        }
                    } else {
                        bootbox.alert({ message: '加载新闻数据失败！' });
                    }
                },
                error: function () {
                    bootbox.alert({ message: '加载新闻数据失败！' });
                }
            });
        }

        // 加载新闻信息的数据
        function loadProductInfoData(data) {
            // 网页标题
            document.title = data.NewsInfo.Title;

            // 新闻信息
            $('#spTitle').text(data.NewsInfo.Title);
            var newsContent = unescape(data.NewsInfo.NewsContent.replace(/\$/g, '%'));
            var newEditorContent = newsContent.replace(/<img [^>]*src=['"]([^'"]+)[^>]*>/gi, function (img, src) {
                return img.replace(/src=['"]([^'"]+)/, function (newimg, newsrc) {
                    var requestUrl = dataServiceBaseUrl + 'api/Common/FileManage?sid=' + sid + '&path=';
                    return 'src="' + requestUrl + newsrc.replace('/Image/', '');
                });
            });
            $('#newcontent').html(newEditorContent);
            $('#PublishTime').text(data.NewsInfo.PublishTime == null ? '' : new Date(data.NewsInfo.PublishTime.replace(/-/g, '/')).Format('yyyy-MM-dd'));
            $('#CreateUserName').text(data.NewsInfo.CreateUserName);
            initLightBox();
        }

        // 初始化图片查看控件
        function initLightBox() {
            lightbox.option({
                showImageNumberLabel: true,
                albumLabel: '第%1张，共%2张。',
                disableScrolling: false,
                alwaysShowNavOnTouchDevices: true,
                wrapAround: true
            });
        }

        //function a() {
        //    var b = "file://D:\banner-left.png";
        //    $("#img")[0].innerHTML = "<img id='img1' src='//localhost/d/banner-left.png'></img>";
        //    //$("#img")[0].innerHTML = "<img id='img1' src='../../assets/img/clock.png'></img>";
        //}
    </script>
</body>
</html>


