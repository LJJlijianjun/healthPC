<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>案例库信息</title>
    <link href="../../assets/css/base.css" rel="stylesheet" />
    <link href="../../assets/vendors/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="../../assets/vendors/font-awesome/css/font-awesome.min.css" rel="stylesheet" />
    <link href="../../assets/vendors/bootstrap-tagsinput/dist/bootstrap-tagsinput.css" rel="stylesheet" />
    <link href="../../assets/vendors/blueimp-file-upload/css/jquery.fileupload.css" rel="stylesheet" />
    <link href="../../assets/vendors/blueimp-file-upload/css/jquery.fileupload-ui.css" rel="stylesheet" />
    <link href="../../assets/vendors/iCheck/skins/square/blue.css" rel="stylesheet" />
    <link href="../../assets/vendors/select2/dist/css/select2.min.css" rel="stylesheet" />
    <link href="../../assets/vendors/lightbox2/dist/css/lightbox.min.css" rel="stylesheet" />
    <link href="../../assets/vendors/gw-userOrgSelector/dist/gw-userOrgSelector.min.css?v=1.0.0" rel="stylesheet" />
    <link href="../../assets/vendors/smalot-bootstrap-datetimepicker/css/bootstrap-datetimepicker.min.css" rel="stylesheet" />
    <link href="../../assets/vendors/LoadingUI/jquery.loadingui.css" rel="stylesheet" />
    <link href="../../assets/css/common.min.css?v=1.0.2" rel="stylesheet" />
    <link href="../../assets/css/page.min.css?v=1.0.2" rel="stylesheet" />
    <style>
        .icheckbox_square-blue-16 {
            margin:0;
        }
        .table>tbody>tr>td {
            padding:5px;
        }
    </style>
</head>
<body>
    <div class="caseInfo-publishView">
        <div class="container-fluid">
            <div class="row processInfo">
                <div class="col-xs-6 pl10 textLeft">
                    <span>当前操作：</span>
                    <span class="process-currentTask"></span>
                </div>
                <div class="col-xs-6 pr10 textRight">
                    <a class="process-detail" href="#">流转明细及回退意见</a>&nbsp;&nbsp;
                    <!--<a href="#" class="process-picture" data-lightbox="processPic" data-title="流程图示">流程图示</a>-->
                </div>
                <div class="col-xs-12 pl10 textLeft">
                    <span class="process-backReasonDesc"></span>
                    <span class="process-backReason"></span>
                </div>
            </div>

            <div class="row processToolBar">
                <div class="col-xs-6 textLeft">
                    <div class="alert alert-danger formTip">
                        <span class="fa fa-info-circle"></span>
                        <span>红色标识字段为必填项！</span>
                    </div>
                </div>
                <div class="col-xs-6 textRight">
                    <div class="btn-group processButtonGroup">
                    </div>
                </div>
            </div>

            <form id="form1" novalidate="novalidate">
                <div class="row mt10">
                    <div class="col-xs-6 pr15">
                        <div class="input-group">
                            <span class="input-group-addon required">成交情况标题</span>
                            <input class="form-control" id="txtTitle" name="txtTitle" data-popover-placement="bottom" type="text" maxlength="500" placeholder="" />
                        </div>
                    </div>
                </div>
                <div class="panel panel-default mt10">
                    <div class="panel-heading" style="padding:2px 15px;">
                        <div class="panel-title">
                            <div class="row">
                                <div class="col-xs-6" style="line-height:35px; color:#a94442">成交情况编辑</div>
                                <div class="col-xs-6">
                                    <div class="btn-group" style="float:right">
                                        <button class="btn btn-default" id="btnSearch" type="button" onclick="addRow()">
                                            <span class="fa fa-plus"></span> 新增
                                        </button>
                                        <button class="btn btn-default" id="btnReset" type="button" onclick="delRow()">
                                            <span class="fa fa-minus"></span> 删除一行
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="panel-body">
                        <div class="row">
                            <table class="table table-bordered" id="tblTrade">
                                <tr>
                                    <td style="width:4%; text-align:center">
                                        <input type="checkbox">
                                        <input type="hidden" name="txtTradeInfoID" value="-1" />
                                    </td>
                                    <td style="width:24%">
                                        <div class="input-group">
                                            <span class="input-group-addon required">产品</span>
                                            <input class="form-control" type="text" name="txtProduct" data-id="" readonly="readonly"/>
                                            <span class="input-group-btn">
                                                <button class="btn btn-default" type="button" onclick="openProductSelector(this)">选择</button>
                                            </span>
                                        </div>
                                    </td>
                                    <td style="width:24%">
                                        <div class="input-group">
                                            <span class="input-group-addon required">成交对手方</span>
                                            <input class="form-control" type="text" name="txtUser" data-id="" readonly="readonly"/>
                                            <span class="input-group-btn">
                                                <button class="btn btn-default" type="button" onclick="openCustomSelector(this)">选择</button>
                                            </span>
                                        </div>
                                    </td>
                                    <td style="width:24%">
                                        <div class="input-group">
                                            <span class="input-group-addon required">成交金额</span>
                                            <input type="text" class="form-control" name="txtVolume" maxlength="7" />
                                            <span class="input-group-addon">万元</span>
                                        </div>
                                    </td>
                                    <td style="width:24%">
                                        <div class="input-group">
                                            <span class="input-group-addon required">成交时间</span>
                                            <input class="form-control" type="text" name="txtTradeTime" id="txtTradeTime" readonly="readonly"/>
                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
            </form>
            <div style="margin-top:10px; margin-bottom: 15px " class="col-xs-12 textRight">
                <div class="btn-group processButtonGroup">
                </div>
            </div>
        </div>
        <!--<input type="hidden" id="hidTradeInfoId" value="-1"/>-->
        <input type="hidden" id="hidPublishOrgID" value="-1"/>
        <a id="totop" href="#" title="回到顶部"><i class="fa fa-angle-up"></i></a>
        <!--注册用户选择模态框-->
        <div class="modal fade" id="customInfoSelectModal" tabindex="-1" role="dialog" aria-hidden="true">
            <div class="modal-dialog" style="width:860px;">
                <div class="modal-content">
                    <div class="modal-body" style="height:540px; padding:0">
                        <button type="button" class="close none" id="btnCloseCustomInfoSelectModal" data-dismiss="modal" aria-hidden="true" title="关闭">&times;</button>
                        <iframe id="frameCustomInfoSelector" frameborder="0" style="border-radius:6px"></iframe>
                    </div>
                </div>
            </div>
        </div>
        <!--产品选择模态框-->
        <div class="modal fade" id="productInfoSelectModal" tabindex="-1" role="dialog" aria-hidden="true">
            <div class="modal-dialog" style="width:860px;">
                <div class="modal-content">
                    <div class="modal-body" style="height:540px; padding:0">
                        <button type="button" class="close none" id="btnCloseProductInfoSelectModal" data-dismiss="modal" aria-hidden="true" title="关闭">&times;</button>
                        <iframe id="frameProductInfoSelector" frameborder="0" style="border-radius:6px"></iframe>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--[if lt IE 9]>
    <script src="../../assets/vendors/html5shiv/dist/html5shiv.min.js" type="text/javascript"></script>
    <script src="../../assets/vendors/respond/src/respond.js" type="text/javascript"></script>
    <![endif]-->
    <script src="../../assets/vendors/jquery/dist/jquery.min.js" type="text/javascript"></script>
    <script src="../../assets/js/jquery-tools-min.js" type="text/javascript"></script>
    <script src="../../assets/js/config.min.js?v=1.0.0" type="text/javascript"></script>
    <script src="../../assets/js/auth.min.js?v=1.0.0" type="text/javascript"></script>
    <script src="../../assets/vendors/bootstrap/dist/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="../../assets/js/common.min.js?v=1.0.3" type="text/javascript"></script>
    <script src="../../assets/js/workFlow.js?v=1.0.2" type="text/javascript"></script>
    <script src="../../assets/vendors/select2/dist/js/select2.full.min.js"></script>
    <script src="../../assets/vendors/bootstrap-tagsinput/dist/bootstrap-tagsinput.js" type="text/javascript"></script>
    <script src="../../assets/vendors/jquery-validation/dist/jquery.validate.min.js" type="text/javascript"></script>
    <script src="../../assets/vendors/jquery-validation/src/localization/messages_zh.js"></script>
    <script src="../../assets/vendors/blueimp-file-upload/js/vendor/jquery.ui.widget.js" type="text/javascript"></script>
    <script src="../../assets/vendors/blueimp-tmpl/js/tmpl.min.js" type="text/javascript"></script>
    <script src="../../assets/vendors/blueimp-load-image/js/load-image.all.min.js" type="text/javascript"></script>
    <script src="../../assets/vendors/blueimp-file-upload/js/jquery.iframe-transport.js" type="text/javascript"></script>
    <script src="../../assets/vendors/blueimp-file-upload/js/jquery.fileupload.js" type="text/javascript"></script>
    <script src="../../assets/vendors/blueimp-file-upload/js/jquery.fileupload-process.js" type="text/javascript"></script>
    <script src="../../assets/vendors/blueimp-file-upload/js/jquery.fileupload-validate.js" type="text/javascript"></script>
    <script src="../../assets/vendors/blueimp-file-upload/js/jquery.fileupload-ui.js?v=1.0.1" type="text/javascript"></script>
    <script src="../../assets/vendors/blueimp-file-upload/js/jquery.fileupload-image.js" type="text/javascript"></script>
    <!-- The XDomainRequest Transport is included for cross-domain file deletion for IE 8 and IE 9 -->
    <!--[if (gte IE 8)&(lt IE 10)]>
    <script src="../../assets/vendors/blueimp-file-upload/js/cors/jquery.xdr-transport.js" type="text/javascript"></script>
    <![endif]-->
    <script src="../../assets/vendors/iCheck/icheck.min.js"></script>
    <script src="../../assets/vendors/underscore/underscore-min.js" type="text/javascript"></script>
    <script src="../../assets/vendors/gw-userOrgSelector/dist/gw-userOrgSelector.min.js?v=1.0.0" type="text/javascript"></script>
    <script src="../../assets/vendors/smalot-bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js" type="text/javascript"></script>
    <script src="../../assets/vendors/smalot-bootstrap-datetimepicker/js/locales/bootstrap-datetimepicker.zh-CN.js" type="text/javascript"></script>
    <script src="../../assets/vendors/xss/dist/xss.min.js" type="text/javascript"></script>
    <script src="../../assets/vendors/LoadingUI/jquery.loadingui.js" type="text/javascript"></script>
    <script src="../../assets/vendors/lightbox2/dist/js/lightbox.min.js" type="text/javascript"></script>
    <script src="../../assets/vendors/platform.js/platform.js" type="text/javascript"></script>
    <script src="../../assets/vendors/bootbox.js/bootbox.js" type="text/javascript"></script>
    <script type="text/javascript">
        $('#selBusinessType').select2({ width: 'resolve' });
    </script>
    <script type="text/javascript">
        var bModifiedFlag = false;
        var bDeleteFlag = false;
        var dateSelOption = {
            language: 'zh-CN',
            weekStart: 1,
            todayBtn: 1,
            todayHighlight: 1,
            endDate:new Date(),
            startView: 2,
            minView: 2,
            autoclose: 1,
            format: 'yyyy-mm-dd',
            forceParse: true,
            pickerPosition: "bottom-right"
        }
        $(function () {
            AuthUtility.Auth(function () {
                initWorkFlow();
                initValidator();
                loadForm();
                bindEvent();
                initLightBox();
                
            });

        });

        // 初始化工作流
        function initWorkFlow() {
            $(document).Workflow('ProcessInfo', {
                Btn: {
                    // 点击保存按钮
                    Save: function () {
                        saveForm('save', function () {
                            WorkflowAction.Save();
                        });
                    },
                    // 点击预览
                    Preview: function () {
                        //saveForm('preview', function () {
                        //    document.getElementById('hidPreviewLink').click();
                        //});
                        var customInfoUrl = '../Common/Selector/CustomInfoSelector.html';
                        $('#frameCustomInfoSelector').attr('src', customInfoUrl);
                        $('#customInfoSelectModal').modal({ backdrop: 'static', keyboard: false });
                    },
                    // 点击下一步按钮
                    Next: function () {
                        saveForm('next', function () {
                            WorkflowAction.Next();
                        });
                    },
                    // 点击删除按钮
                    Delete: function () {
                        bootbox.confirm({
                            size: 'small',
                            message: "确定要删除吗？",
                            callback: function (result) {
                                if (result === true) {
                                    deleteForm(function (data) {
                                        if (data && data.Success === true && data.Data === 0) {
                                            bModifiedFlag = false;
                                            bDeleteFlag = true;
                                            bootbox.alert({
                                                message: '删除成功！',
                                                callback: function () {
                                                    WorkflowEngine.RedirectToDoListPage();
                                                }
                                            });
                                        } else {
                                            bootbox.alert({ message: '删除失败！' });
                                        }
                                    });
                                }
                            }
                        });
                    }
                }
            });
        }

        // 初始化表单验证控件
        function initValidator() {
            $.validator.addMethod("antiSqlInject", function (value, element, params) {
                if (value) {
                    return !AntiSqlInject($(element).val());
                } else {
                    return value;
                }
            }, "输入内容中包含非法字符！");

            $.validator.addMethod("checkNaN", function (value, element) {
                //var period = /^d+$/;
                return this.optional(element) || !isNaN(value);
            }, "只能输入数字！");
           
            $('#form1').validate({
                rules: {
                    txtTitle: { required: true },
                    txtProduct: { required: true },
                    txtUser: { required: true },
                    txtVolume: { required: true, checkNaN:true},
                    txtTradeTime: { required: true }
                },
                messages: {
                    txtTitle: { required: '成交情况标题不能为空！' },
                    txtProduct: { required: '产品不能为空！' },
                    txtUser: { required: '成交对手方不能为空！' },
                    txtVolume: { required: '成交金额不能为空！' },
                    txtTradeTime: { required: '成交时间不能为空！' }
                },
                showErrors: jqValidationShowErrors
            });
        }

        // 加载表单
        function loadForm() {
            $.ajax({
                url: dataServiceBaseUrl + 'api/TradeInfo/TradeInfo/GetTradeInfoByProcessId?sid=' + sid,
                type: 'get',
                data: {
                    processId: $.url().param("processId").trim()
                },
                beforeSend: function () {
                    $('body').loadingUI({ text: '加载中...' });
                },
                async: true,
                cache: false,
                dataType: 'json',
                success: function (data) {
                    if (data && data.Success === true && data.Data.TradeInfoList.length > 0) {
                        $('#hidPublishOrgID').val(data.Data.PublishOrgID);
                        $.each(data.Data.TradeInfoList, function (row, obj) {
                            if (row !== 0) {
                                addRow();
                            } else {
                                $('#txtTitle').val(obj.Title);
                            }
                            $("#tblTrade").find("tr").eq(row).find("input[name=txtTradeInfoID]").val(obj.ID);
                            var productDom = $("#tblTrade").find("tr").eq(row).find("input[name=txtProduct]");
                            productDom.data('id', obj.ProductInfoID);
                            productDom.val(obj.ProductName);
                            var userDom = $("#tblTrade").find("tr").eq(row).find("input[name=txtUser]");
                            userDom.data('id', obj.CustomerUserID);
                            userDom.val(obj.CustomerName);
                            $("#tblTrade").find("tr").eq(row).find("input[name=txtVolume]").val(obj.TradeAmount);
                            $("#tblTrade").find("tr").eq(row).find("input[name=txtTradeTime]").val(obj.TradeTime);
                        });
                    } 
                    $('body').loadingUI('hide');
                },
                error: function () {
                    bootbox.alert({ message: '加载失败！' });
                    $('body').loadingUI('hide');
                }
            });
        }

        // 初始化业务类型选择列表
        function initBusinessTypeSelector(val) {
            var sel = $("#selBusinessType");
            var url = dataServiceBaseUrl + 'api/SysMaintain/Dictionary?sid=' + sid;
            var data = {
                searchModel: {
                    TypeId: 6,
                    PageNum: 1,
                    PageSize: 0,
                    IsActive: 1
                }
            };
            bindSelector(sel, url, data, val);
        }

        //select2绑定数据
        function bindSelector(sel, url, data, val) {
            sel.select2({
                selectOnClose: false,
                allowClear: false,
                minimumResultsForSearch: Infinity,
                width: '99.9%'
            });
            $.getJSON(url, data, function (result) {
                if (result && result.Success === true && result.Data) {
                    $.each(result.Data.rows, function (i, item) {
                        sel.append("<option value='" + item.Dkey + "'>" + item.DValue + "</option>");
                    });
                    sel.val(val);
                    sel.trigger('change.select2');
                    bModifiedFlag = false;
                }
            });
        }

        // 检查表单状态，如果有未保存的修改，返回true，否则返回false
        function checkFormModified() {
            return bModifiedFlag;
        }

        // 绑定事件
        function bindEvent() {
            //表单改动监听事件
            $('#txtTitle,#txtContactsName,#txtAreaFixedTel,#txtContactsFixedTel,#txtContactsMobileTel,#txtContactsEmail,#selBusinessType').change(function () {
                bModifiedFlag = true;
            });

            // 回到顶部功能
            $(window).scroll(function () {
                if ($(this).scrollTop() < 100) {
                    $('#totop').fadeOut();
                } else {
                    $('#totop').fadeIn();
                }
            });
            $('#totop').on('click', function () {
                $('html,body').animate({ scrollTop: 0 }, 'fast');
                return false;
            });

            //初始化ICheck选择框
            $('input[type=checkbox]').iCheck({
                checkboxClass: 'icheckbox_square-blue-16'
            }).on('ifClicked', function () {
                if ($(this).is(':checked')) {
                    $(this).iCheck('uncheck');
                } else {
                    $('input[type=checkbox]').iCheck('uncheck');
                    $(this).iCheck('check');
                }
            });
            $('#txtTradeTime').datetimepicker(dateSelOption);
        }

        // 保存表单
        function saveForm(action, callback) {
            if ($('#form1').valid()) {
                var tradeDomList = $('#tblTrade tr');
                var formData = [];
                tradeDomList.each(function (row, obj) {
                    var id = $(this).find('input[name=txtTradeInfoID]').val();
                    var customId = $(this).find('input[name=txtUser]').data('id');
                    var productId = $(this).find('input[name=txtProduct]').data('id');
                    var volume = filterXSS($(this).find('input[name=txtVolume]').val());
                    var tradeTime = filterXSS($(this).find('input[name=txtTradeTime]').val());
                    if(id == "-1"){
                        formData.push({
                            Title: $('#txtTitle').val(),
                            CustomerUserID: customId,
                            ProductInfoID: productId,
                            TradeAmount: volume,
                            TradeTime: tradeTime
                        });
                    } else {
                        formData.push({
                            ID: id,
                            Title: $('#txtTitle').val(),
                            CustomerUserID: customId,
                            ProductInfoID: productId,
                            TradeAmount: volume,
                            TradeTime: tradeTime
                        });
                    }
                
                });

                $.ajax({
                    url: dataServiceBaseUrl + 'api/TradeInfo/TradeInfo?processId=' + $.url().param("processId").trim() + '&sid=' + sid + '&clientInfo=' + getClientInfo(),
                    type: 'post',
                    data: JSON.stringify(formData),
                    beforeSend: function () {
                        if (action === 'save') {
                            $('body').loadingUI({ text: '保存中...' });
                            $('button[name=btnWf_Save]').button('loading');
                        }
                    },
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                    cache: false,
                    success: function (data) {
                        if (data && data.Success === true && data.Data.length !== 0) {
                            bModifiedFlag = false;
                            $.each(data.Data, function (row,obj) {
                                $("#tblTrade").find("tr").eq(row).find("input[name=txtTradeInfoID]").val(obj.ID);
                                if ($('#hidPublishOrgID').val() == "-1") {
                                    $('#hidPublishOrgID').val(data.Data.PublishOrgID);
                                }
                            });
                            callback();
                        }
                        if (action === 'save') {
                            $('body').loadingUI('hide');
                            $('button[name=btnWf_Save]').button('reset');
                        }
                    },
                    error: function () {
                        bootbox.alert({ message: '保存失败！' });
                        if (action === 'save') {
                            $('body').loadingUI('hide');
                            $('button[name=btnWf_Save]').button('reset');
                        }
                    }
                });
            }
        }

        // 删除表单
        function deleteForm(callback) {
            $.ajax({
                url: dataServiceBaseUrl + 'api/TradeInfo/TradeInfo/DeleteTradeInfoByProcessID?ProcessID=' + $.url().param("processId").trim() + '&sid=' + sid + '&clientInfo=' + getClientInfo(),
                type: 'delete',
                async: false,
                cache: false,
                dataType: 'json',
                success: function (data) {
                    if (callback) callback(data);
                }
            });
        }

        //新增一行
        function addRow() {
            var rowStr = '';
            rowStr += '<tr><td style="width:4%; text-align:center"><input type="checkbox"><input type="hidden" name="txtTradeInfoID" value="-1" /></td>';

            rowStr += '<td style="width:24%"><div class="input-group"><span class="input-group-addon required">产品</span>';
            rowStr += '<input class="form-control" type="text" name="txtProduct" data-id="" readonly="readonly" />';
            rowStr += '<span class="input-group-btn"><button class="btn btn-default" type="button" onclick="openProductSelector(this)">选择</button></span></div></td>';

            rowStr += '<td style="width:24%"><div class="input-group"><span class="input-group-addon required">成交对手方</span>';
            rowStr += '<input class="form-control" type="text" name="txtUser" data-id="" readonly="readonly" />';
            rowStr += '<span class="input-group-btn"><button class="btn btn-default" type="button" onclick="openCustomSelector(this)">选择</button></span></div></td>';

            rowStr += '<td style="width:24%"><div class="input-group"><span class="input-group-addon required">成交金额</span>';
            rowStr += '<input type="text" class="form-control" name="txtVolume" maxlength="7"/><span class="input-group-addon">万元</span></div></td>';

            rowStr += '<td style="width:24%"><div class="input-group"><span class="input-group-addon required">成交时间</span>';
            rowStr += '<input class="form-control" type="text" name="txtTradeTime" readonly="readonly" /></div></td></tr>';

            $('#tblTrade').append(rowStr);

            $('#tblTrade tr:last input[type=checkbox]').iCheck({
                checkboxClass: 'icheckbox_square-blue-16'
            }).on('ifClicked', function () {
                if ($(this).is(':checked')) {
                    $(this).iCheck('uncheck');
                } else {
                    $('input[type=checkbox]').iCheck('uncheck');
                    $(this).iCheck('check');
                }
            });
            $('#tblTrade tr:last input[name=txtTradeTime]').datetimepicker(dateSelOption);
        }

        function delRow() {
            if ($('#tblTrade tr').length == 1) {
                bootbox.alert({ message: '如要删除此流程，请点删除按钮！' });
                return;
            }
            if ($("#tblTrade :checked").length == 0) {
                bootbox.alert({ message: '请选择要删除的内容！' });
                return;
            }
            var tr = $("#tblTrade :checked").parents('tr');
            if (tr.find('input[name=txtTradeInfoID]').val() == "-1") {
                tr.remove();
            } else {
                delRowInData(tr.find('input[name=txtTradeInfoID]').val(),tr);
            }
        }

        function delRowInData(id,row) {
            $.ajax({
                url: dataServiceBaseUrl + 'api/TradeInfo/TradeInfo?tradeInfoId=' + id + '&sid=' + sid,
                type: 'delete',
                async: false,
                cache: false,
                dataType: 'json',
                success: function (data) {
                    row.remove();
                }
            });
        }

        function openCustomSelector(btn) {
            var row = $(btn).parents('tr').index();
            var customInfoUrl = '../Common/Selector/CustomInfoSelector.html?index=' + row;
            $('#frameCustomInfoSelector').attr('src', customInfoUrl);
            $('#customInfoSelectModal').modal({ backdrop: 'static', keyboard: false });
        }

        function openProductSelector(btn) {
            var row = $(btn).parents('tr').index();
            var productInfoUrl = '../Common/Selector/ProductSelector.html?index=' + row;
            $('#frameProductInfoSelector').attr('src', productInfoUrl);
            $('#productInfoSelectModal').modal({ backdrop: 'static', keyboard: false });
        }

        function getCustomInfo(id, val, row) {
            var customDom = $("#tblTrade").find("tr").eq(row).find("input[name=txtUser]");
            customDom.data('id', id);
            customDom.val(val);
        }

        function getProductInfo(id, val, row) {
            var productDom = $("#tblTrade").find("tr").eq(row).find("input[name=txtProduct]");
            productDom.data('id', id);
            productDom.val(val);
        }


        // 初始化图片查看控件
        function initLightBox() {
            lightbox.option({
                showImageNumberLabel: true,
                albumLabel: '第%1张，共%2张。',
                disableScrolling: false,
                alwaysShowNavOnTouchDevices: true,
                wrapAround: true
            });
        }
    </script>
</body>
</html>
