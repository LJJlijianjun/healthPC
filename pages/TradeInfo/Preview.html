<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title></title>
    <link href="../../assets/css/base.css" rel="stylesheet" />
    <link href="../../assets/vendors/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="../../assets/vendors/font-awesome/css/font-awesome.min.css" rel="stylesheet" />
    <link href="../../assets/vendors/gw-pageSideBar/dist/gw-pageSideBar.min.css?v=1.0.0" rel="stylesheet" />
    <link href="../../assets/vendors/lightbox2/dist/css/lightbox.min.css" rel="stylesheet" />
    <link href="../../assets/css/common.min.css?v=1.0.2" rel="stylesheet" />
    <link href="../../assets/css/page.min.css?v=1.0.2" rel="stylesheet" />
    <script type="text/javascript">
        try {
            window.moveTo(0, 0);
            window.resizeTo(window.screen.availWidth, window.screen.availHeight);
        } catch (e) {
        }
    </script>
</head>
<body>
    <div class="caseInfo-readView">
        <div class="content">
            <span class="articleVersion" id="spVersion"></span>
            <div class="home"><i class="fa fa-home" title="返回首页"></i><span class="text" title="返回首页">返回首页</span></div>
            <p class="articleTitle" id="pTitle"></p>
            <div class="articleInfo">
                <div class="articleBaseInfo">
                    <div>
                        <span>发布时间：</span>
                        <span id="spPublishTime" style="color: red;"></span>
                        <span class="ml20">发布人：</span>
                        <span id="spCreateUserName"></span>
                    </div>
                    <div>
                        <span>发布单位：</span>
                        <span id="spPublishOrgName"></span>
                    </div>
                </div>
                <div class="articleToolbar">
                    <div class="btn-group">
                        <button class="btn btn-default" id="btnDownLoadAll" type="button"><span class="fa fa-download"></span>&nbsp;全部下载</button>
                        <button class="btn btn-default" id="btnFav" type="button"><span class="fa fa-star-o"></span>&nbsp;添加收藏</button>
                    </div>
                </div>
            </div>
            <div class="splitLine"></div>
            <div class="articleContent">
                <div class="h600">
                    <iframe id="mainContentReadFrame" frameborder="0"></iframe>
                </div>
                <div class="mt20">
                    <table role="presentation" class="table table-condensed table-bordered">
                        <tr class="h35">
                            <td class="textRight" style="background-color: #F5F5F5">
                                <span>业务类型：</span>
                            </td>
                            <td colspan="3">
                                <span id="spBusinessType"></span>
                            </td>
                        </tr>
                        <tr class="h35">
                            <td class="textRight w110 f5-bg">
                                <span>联系人：</span>
                            </td>
                            <td class="w310">
                                <span id="spContactsName"></span>
                            </td>
                            <td class="textRight w110 f5-bg">
                                <span>电话：</span>
                            </td>
                            <td class="w310">
                                <span id="spContactsFixedTel"></span>
                            </td>
                        </tr>
                        <tr class="h35">
                            <td class="textRight f5-bg">
                                <span>手机：</span>
                            </td>
                            <td>
                                <span id="spContactsMobileTel"></span>
                            </td>
                            <td class="textRight f5-bg">
                                <span>邮箱：</span>
                            </td>
                            <td>
                                <span id="spContactsEmail"></span>
                            </td>
                        </tr>
                    </table>
                </div>

                <div class="articleAttach caseInfoAttachment">
                    <div class="attachToolbar">
                        <div class="attachTitle">
                            <i class="fa fa-paperclip"></i>&nbsp;相关附件
                        </div>
                        <div class="download">
                            <button class="btn btn-default" type="button">
                                <i class="fa fa-download"></i>&nbsp;打包下载
                            </button>
                        </div>
                    </div>
                    <div class="attachList">
                    </div>
                </div>

                <div class="mt20 none" id="divCaseInfoRelProductInfo">
                    <div class="title">
                        产品归属
                    </div>
                    <div class="mt10">
                        <table role="presentation" class="table table-condensed table-bordered">
                            <thead>
                                <tr class="h35">
                                    <td class="w50 boldFont">序号</td>
                                    <td class="boldFont">产品名称</td>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                        <div class="noRecordTip"></div>
                    </div>
                </div>
            </div>

            <div class="mt20 none" id="divCaseInfoRelProjectInfo">
                <div class="title">
                    关联项目
                </div>
                <div class="mt10">
                    <table role="presentation" class="table table-condensed table-bordered">
                        <thead>
                            <tr class="h35">
                                <td class="w50 boldFont">序号</td>
                                <td class="boldFont">项目名称</td>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                    <div class="noRecordTip"></div>
                </div>
            </div>

            <div class="addQuestion">
                <div class="head">
                    <div class="title">
                        <span class="fa fa-question-circle"></span>&nbsp;提交问题
                    </div>
                    <button class="btn btn-primary" id="btnAddQuestion" type="button">我要提问</button>
                </div>
                <div class="questionContent">
                    <textarea class="form-control" id="txtQuestionContent" name="txtQuestionContent" rows="5" maxlength="200" placeholder="在此输入问题内容..."></textarea>
                </div>
            </div>

            <div class="questionList">
                <div class="head">
                    <div class="title">
                        <span class="fa fa-th-large"></span>&nbsp;问题列表
                    </div>
                    <div class="statistics">0提问&nbsp;&nbsp;·&nbsp;&nbsp;0回复</div>
                </div>
                <div class="questionListDetail">
                </div>
            </div>
        </div>
        <div id="pageSideBar"></div>
    </div>
    <!--[if lt IE 9]>
    <script src="../../assets/vendors/html5shiv/dist/html5shiv.min.js" type="text/javascript"></script>
    <script src="../../assets/vendors/respond/src/respond.js" type="text/javascript"></script>
    <![endif]-->
    <script src="../../assets/vendors/jquery/dist/jquery.min.js" type="text/javascript"></script>
    <script src="../../assets/js/jquery-tools-min.js" type="text/javascript"></script>
    <script src="../../assets/js/config.min.js?v=1.0.0" type="text/javascript"></script>
    <script src="../../assets/js/auth.min.js?v=1.0.0" type="text/javascript"></script>
    <script src="../../assets/vendors/bootstrap/dist/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="../../assets/js/common.min.js?v=1.0.3" type="text/javascript"></script>
    <script src="../../assets/vendors/underscore/underscore-min.js" type="text/javascript"></script>
    <script src="../../assets/js/workFlow.min.js?v=1.0.2" type="text/javascript"></script>
    <script src="../../assets/vendors/gw-pageSideBar/dist/gw-pageSideBar.min.js?v=1.0.0" type="text/javascript"></script>
    <script src="../../assets/vendors/lightbox2/dist/js/lightbox.min.js"></script>
    <script src="../../assets/vendors/bootbox.js/bootbox.js" type="text/javascript"></script>
    <script type="text/javascript">
        var caseInfoId = $.url().fparam('id');

        $(function () {
            AuthUtility.Auth(function () {
                if (!caseInfoId || !parseInt(caseInfoId)) return;
                getCaseInfo();
            });
        });

        // 获取案例信息
        function getCaseInfo() {
            $.ajax({
                url: dataServiceBaseUrl + 'api/CaseInfo/CaseInfo/GetPreviewCaseInfo?sid=' + sid,
                type: 'get',
                data: {
                    caseInfoId: caseInfoId
                },
                async: true,
                cache: false,
                success: function (data) {
                    if (data && data.Success === true) {
                        if (data.Message == 'InvalidUser' || data.Message == 'NoPermisson') {
                            window.location.href = '../Common/NoRight.html';
                        } else if (data.Data) {
                            loadCaseInfoData(data.Data);
                        }
                    } else {
                        bootbox.alert({ message: '加载案例数据失败！' });
                    }
                },
                error: function () {
                    bootbox.alert({ message: '加载案例数据失败！' });
                }
            });
        }

        // 加载案例数据
        function loadCaseInfoData(data) {
            // 网页标题
            document.title = data.CaseInfo.Title;

            // 案例信息Part1
            $('#spVersion').text((data.CaseInfo.Version === 'A' && data.CaseInfo.Status !== 5) ? '' : data.CaseInfo.Version + '版');
            $('#pTitle').text(data.CaseInfo.Title);
            $('#spPublishTime').text('以实际发布时间为准');
            $('#spCreateUserName').text(data.CaseInfo.CreateUserName);
            $('#spPublishOrgName').text(data.CaseInfo.PublishOrgName);

            // 案例正文
            var mainDoc;
            if ($.browser.msie && parseInt($.browser.version) < 9) {
                mainDoc = _.where(data.Documents, { DocumentType: 1, FileExtType: 'swf' });
            } else {
                mainDoc = _.where(data.Documents, { DocumentType: 1, FileExtType: 'pdf' });
            }
            if (mainDoc && mainDoc.length === 1) {
                $('#mainContentReadFrame').attr('src', '../Common/FileReader.html?fileId=' + mainDoc[0].FileID + '&fileName=' + encodeURIComponent(mainDoc[0].OriginFileName));
            }

            // 案例信息Part2
            $('#spBusinessType').text(data.CaseInfo.BusinessType);
            $('#spContactsName').text(data.CaseInfo.ContactsName);
            $('#spContactsFixedTel').text(data.CaseInfo.ContactsFixedTel);
            $('#spContactsMobileTel').text(data.CaseInfo.ContactsMobileTel);
            $('#spContactsEmail').text(data.CaseInfo.ContactsEmail);

            // 相关附件
            bindFileList('caseInfoAttachment', 0, _.where(data.Documents, { DocumentType: 2 }));

            // 关联产品
            if (data.CaseInfoRelProductInfo && data.CaseInfoRelProductInfo.length > 0) {
                for (var i = 0; i < data.CaseInfoRelProductInfo.length; i++) {
                    $('#divCaseInfoRelProductInfo table tbody').append('<tr class="h35">' +
                                                                                        '<td class="textCenter">' + (i + 1) + '</td>' +
                                                                                        '<td class="textLeft"><a href="../ProductInfo/Read.html#id={0}" target="_blank" title="{1}">{1}</a></td>'.format(data.CaseInfoRelProductInfo[i].ProductInfoID, data.CaseInfoRelProductInfo[i].ProductInfoTitle) +
                                                                                    '</tr>');
                }
                $('#divCaseInfoRelProductInfo').removeClass('none');
            }

            // 关联项目
            if (data.CaseInfoRelProjectInfo && data.CaseInfoRelProjectInfo.length > 0) {
                for (var i = 0; i < data.CaseInfoRelProjectInfo.length; i++) {
                    $('#divCaseInfoRelProjectInfo table tbody').append('<tr class="h35">' +
                                                                                        '<td class="textCenter">' + (i + 1) + '</td>' +
                                                                                        '<td class="textLeft"><a href="../ProjectInfo/Read.html#id={0}" target="_blank" title="{1}">{1}</a></td>'.format(data.CaseInfoRelProjectInfo[i].ProjectInfoID, data.CaseInfoRelProjectInfo[i].ProjectInfoTitle) +
                                                                                    '</tr>');
                }
                $('#divCaseInfoRelProjectInfo').removeClass('none');
            }

            // 加载SideBar
            loadPageSideBar();
        }

        // 加载SideBar
        function loadPageSideBar() {
            var sideBarOption = {
                sideBarFunction: ['home', 'quiz', 'favorite', 'toTop'],
                homePath: '../Index.html',
                isFavorite: false,
                onBeforeAddFavorite: function () { return false; },
                onBeforeRemoveFavorite: function () { return false; },
                quizContainer: '#txtQuestionContent',
                bottom: 30,
                right: 20
            };

            $('#pageSideBar').GWPageSideBar(sideBarOption);
        }
    </script>
</body>
</html>